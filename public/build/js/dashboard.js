function loadBookmakersOnDashboard(){$.ajax({url:"bettor/comptes-for-dashboard",type:"get",success:function(e){$("#comptes_par_bookmakers").html(e)},error:function(e){console.log("la récuperation des comptes bookmakers vers le dashboard n'a pas fonctionné")}})}function cb(e,t){$("#defaultrange").html(e.format("DD/MM/YYYY")+" - "+t.format("DD/MM/YYYY"))}function loadGeneralRecapsOnDashboard(){var e=$("#default-range-container #defaultrange").text();$.ajax({url:"generalrecap",type:"get",data:{range:e},success:function(e){$("#tipsters-general-recap").html(e)}})}function totalProfits(){$.getJSON("totalprofit",function(e){var t=e.montantprofit,a=2,r=0===a?1:Math.pow(10,a);$("#overall-profit").animateNumber({number:t*r,numberStep:function(e,t){var n=Math.floor(e)/r,o=$(t.elem);a>0&&(n=n.toFixed(a)),o.prop("number",e).text(parseFloat(n))}},"normal",function(){t>0?($("#overall-profit-sign").text("+"),$("#overall-profit-container").addClass("font-green-sharp").removeClass("red-lose")):0>t?($("#overall-profit-sign").text(""),$("#overall-profit-container").removeClass("font-green-sharp").addClass("red-lose")):($("#overall-profit-sign").text(""),$("#overall-profit-container").removeClass("font-green-sharp").removeClass("red-lose"))})})}function addManualCouponSelection(){function e(){ge.hide(),ve.hide(),d(),L.hide()}function t(){pe.click(function(){pe.is(":checked")?(fe.show(),me.prop("disabled",!1),pe.parents("span").addClass("checked")):(fe.hide(),me.prop("disabled",!0),pe.parents("span").removeClass("checked"))})}function a(){y.select2({allowClear:!0,placeholder:"Choisir un sport",cache:!0,ajax:{url:"sports",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){""==$(this).val()?ge.fadeOut():ge.fadeIn(),P.val(null).trigger("change"),T.removeClass("has-error"),D.empty(),j.val(null).trigger("change"),M.removeClass("has-error"),R.empty(),E.val(null).trigger("change"),A.removeClass("has-error"),N.empty(),d()})}function r(){function e(e){if(!e.id)return e.text;var t=$('<span><img src="img/flags/'+e.country.shortname+'.png" class="img-flag" /> '+e.text+"</span>");return t}b.find(".competitioninputdashboard").select2({allowClear:!0,placeholder:"Choisir une competition",cache:!0,language:"fr",ajax:{url:"competitions",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e}).change(function(){""==$(this).val()?(ve.fadeOut(),d(),E.val(null).trigger("change"),A.removeClass("has-error"),N.empty()):ve.fadeIn()})}function n(){b.find(".marketinputdashboard").select2({allowClear:!0,placeholder:"Choisir un type de pari",cache:!0,ajax:{url:"markets",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){d(),be.show(),_e.show(),Ce.show(),$('[data-toggle="tooltip"]').tooltip();var e=E.val();7==e?(c(),H.fadeIn().show(),Y.html("Vainqueur"+v),I.select2({tags:!0,allowClear:!0,placeholder:"Nom de l'équipe ou du joueur vainqueur"})):8==e?(u(),H.fadeIn().show(),I.select2({data:h,minimumResultsForSearch:1/0}),Y.html("Résultat du match"),ne.text("Equipe Handicap"),re.fadeIn().show(),ae.select2({data:f,minimumResultsForSearch:1/0,placeholder:"Equipe/Joueur"}),G.html("Handicap"+v),V.fadeIn().show(),J.select2({tags:!0,allowClear:!0,placeholder:"2.5 ou -2.5"})):9==e?(m=[{id:"1X",text:"1X"},{id:"X2",text:"X2"},{id:"12",text:"12"}],L.fadeIn().show(),H.fadeIn().show(),I.select2({data:m,minimumResultsForSearch:1/0}),S.val("").trigger("change").prop("disabled",!1),B.val("").trigger("change").prop("disabled",!1),Y.html("Choix")):11==e?(m=[{id:"1/1",text:"1/1"},{id:"1/X",text:"1/X"},{id:"1/2",text:"1/2"},{id:"X/1",text:"X/1"},{id:"X/X",text:"X/X"},{id:"X/2",text:"X/2"},{id:"2/1",text:"2/1"},{id:"2/X",text:"2/X"},{id:"2/2",text:"2/2"}],L.fadeIn().show(),H.fadeIn().show(),I.select2({data:m,minimumResultsForSearch:1/0}),S.val("").trigger("change").prop("disabled",!1),B.val("").trigger("change").prop("disabled",!1),Y.html("Choix")):43==e?(L.fadeIn().show(),H.fadeIn().show(),Y.html("Vainqueur"),I.select2({data:h,minimumResultsForSearch:1/0}),S.val("").trigger("change").prop("disabled",!1),B.val("").trigger("change").prop("disabled",!1)):46==e?(L.fadeIn().show(),H.fadeIn().show(),Y.html("Vainqueur"),I.select2({data:f,minimumResultsForSearch:1/0}),S.val("").trigger("change").prop("disabled",!1),B.val("").trigger("change").prop("disabled",!1)):48==e&&(L.fadeIn().show(),S.val("").trigger("change").prop("disabled",!1),B.val("").trigger("change").prop("disabled",!1),H.fadeIn().show(),V.show(),G.html("Handicap"+v),J.select2({placeholder:"-2.5 ou 2.5",tags:!0}),Y.html("Equipe Handicap"),I.select2({data:f,minimumResultsForSearch:1/0}))})}function o(){j.select2({allowClear:!0,placeholder:"Choisir une portée",cache:!0,ajax:{url:"scopes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}})}function s(){b.find(".pickinputdashboard").select2()}function i(){function e(e){if(!e.id)return e.text;var t=$('<span><img src="img/flags/'+e.country.shortname+'.png" class="img-flag" /> '+e.text+"</span>");return t}b.find(".team1inputdashboard").select2({allowClear:!0,placeholder:"Equipe/Joueur Domicile",cache:!0,ajax:{url:"equipes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e}),b.find(".team2inputdashboard").select2({allowClear:!0,placeholder:"Equipe/Joueur Exterieur",cache:!0,ajax:{url:"equipes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e})}function l(){b.find('button[type="submit"]').on("click",function(e){e.preventDefault();var t,a=b.serialize();t=b.find("#live").is(":checked")?1:0;var r=Ladda.create(this);r.start(),$.ajax({url:"manualcoupon",type:"post",data:a+"&live="+t,success:function(e){0==e.etat?(e.errors.date?(b.find("#date_container").addClass("has-error"),b.find("#date_error").html(e.errors.date)):(b.find("#date_container").removeClass("has-error"),b.find("#date_error").empty()),e.errors.sport?(b.find("#sport_container").addClass("has-error"),b.find("#sport_error").html(e.errors.sport)):(b.find("#sport_container").removeClass("has-error"),b.find("#sport_error").empty()),e.errors.competition?(b.find("#competition_container").addClass("has-error"),b.find("#competition_error").html(e.errors.competition)):(b.find("#competition_container").removeClass("has-error"),b.find("#competition_error").empty()),e.errors.market?(b.find("#market_container").addClass("has-error"),b.find("#market_error").html(e.errors.market)):(b.find("#market_container").removeClass("has-error"),b.find("#market_error").empty()),e.errors.scope?(b.find("#scope_container").addClass("has-error"),b.find("#scope_error").html(e.errors.scope)):(b.find("#scope_container").removeClass("has-error"),b.find("#scope_error").empty()),e.errors.team1?(b.find("#team1_container").addClass("has-error"),b.find("#team1_error").html(e.errors.team1)):(b.find("#team1_container").removeClass("has-error"),b.find("#team1_error").empty()),e.errors.team2?(b.find("#team2_container").addClass("has-error"),b.find("#team2_error").html(e.errors.team2)):(b.find("#team2_container").removeClass("has-error"),b.find("#team2_error").empty()),e.errors.pick?(b.find("#pick_container").addClass("has-error"),b.find("#pick_error").html(e.errors.pick)):(b.find("#pick_container").removeClass("has-error"),b.find("#pick_error").empty()),e.errors.odd_doubleParam?(b.find("#odd_doubleParam_container").addClass("has-error"),b.find("#odd_doubleParam_error").html(e.errors.odd_doubleParam)):(b.find("#odd_doubleParam_container").removeClass("has-error"),b.find("#odd_doubleParam_error").empty()),e.errors.odd_doubleParam2?(b.find("#odd_doubleParam2_container").addClass("has-error"),b.find("#odd_doubleParam2_error").html(e.errors.odd_doubleParam2)):(b.find("#odd_doubleParam2_container").removeClass("has-error"),b.find("#odd_doubleParam2_error").empty()),e.errors.odd_doubleParam3?(b.find("#odd_doubleParam3_container").addClass("has-error"),b.find("#odd_doubleParam3_error").html(e.errors.odd_doubleParam3)):(b.find("#odd_doubleParam3_container").removeClass("has-error"),b.find("#odd_doubleParam3_error").empty()),e.errors.bookmaker?(b.find("#bookmaker_container").addClass("has-error"),b.find("#bookmaker_error").html(e.errors.bookmaker)):(b.find("#bookmaker_container").removeClass("has-error"),b.find("#bookmaker_error").empty()),e.errors.odd_value?(b.find("#odd_container").addClass("has-error"),b.find("#odd_error").html(e.errors.odd_value)):(b.find("#odd_container").removeClass("has-error"),b.find("#odd_error").empty()),e.errors.score?(b.find("#score_container").addClass("has-error"),b.find("#score_error").html(e.errors.score)):(b.find("#score_container").removeClass("has-error"),b.find("#score_error").empty())):(refreshSelections(),p())},complete:function(){r.stop()}})})}function d(){c(),j.html("").val("").trigger("change"),M.removeClass("has-error"),R.empty(),I.html("").val("").trigger("change"),H.hide(),H.removeClass("has-error"),X.empty(),J.html("").val("").trigger("change"),V.hide(),V.removeClass("has-error"),W.empty(),U.html("").val("").trigger("change"),K.hide(),K.removeClass("has-error"),Q.empty(),Z.html("").val("").trigger("change"),ee.hide(),ee.removeClass("has-error"),te.empty(),ae.html("").val("").trigger("change"),re.hide(),re.removeClass("has-error"),oe.empty()}function c(){L.hide(),S.val("").html('<option value=""></option>').trigger("change").prop("disabled",!0),B.val("").html('<option value=""></option>').trigger("change").prop("disabled",!0),z.removeClass("has-error"),O.empty(),F.removeClass("has-error"),q.empty()}function u(){L.show(),S.val("").html('<option value=""></option>').trigger("change").prop("disabled",!1),B.val("").html('<option value=""></option>').trigger("change").prop("disabled",!1)}function p(){_.val(null).trigger("change"),C.removeClass("has-error"),k.empty(),y.val(null).trigger("change"),x.removeClass("has-error"),w.empty(),P.val(null).trigger("change"),T.removeClass("has-error"),D.empty(),E.val(null).trigger("change"),A.removeClass("has-error"),N.empty(),j.val(null).trigger("change"),M.removeClass("has-error"),R.empty(),S.val(null).trigger("change"),z.removeClass("has-error"),O.empty(),B.val(null).trigger("change"),F.removeClass("has-error"),q.empty(),I.val(null).trigger("change"),H.removeClass("has-error"),X.empty(),J.val(null).trigger("change"),V.removeClass("has-error"),W.empty(),U.val(null).trigger("change"),K.removeClass("has-error"),Q.empty(),Z.val(null).trigger("change"),ee.removeClass("has-error"),te.empty(),ae.val(null).trigger("change"),re.removeClass("has-error"),oe.empty(),de.val(null).trigger("change"),ue.removeClass("has-error"),ce.empty(),ie.val(null).trigger("change"),se.removeClass("has-error"),le.empty(),ie.val(null),fe.removeClass("has-error").hide(),he.empty(),me.val("").prop("disabled",!0),pe.parents("span").removeClass("checked"),pe.prop("checked",!1)}var m="",h=[{id:"1",text:"Home"},{id:"2",text:"Away"},{id:"X",text:"Draw"}],f=[{id:"1",text:"Home"},{id:"2",text:"Away"}],g="Quand cet icone apparait, aucune proposition vous sera faite, c'est à vous d'inscrire votre réponse dans le champ de recherche. Cette réponse deviendra ensuite une proposition, vous n'avez alors plus qu'à la selectionner.",v=" <span class='glyphicon glyphicon-save font-red' data-toggle='tooltip' data-title='"+g+"'></span>",b=($("#automaticform-add"),$("#manualselectionform-add")),_=($("#manualBetAddModal").modal("hide"),b.find('input[name="date"]')),C=b.find("#date_container"),k=b.find("#date_error"),y=b.find('select[name="sport"]'),x=b.find("#sport_container"),w=b.find("#sport_error"),P=b.find('select[name="competition"]'),T=b.find("#competition_container"),D=b.find("#competition_error"),E=b.find('select[name="market"]'),A=b.find("#market_container"),N=b.find("#market_error"),j=b.find('select[name="scope"]'),M=b.find("#scope_container"),R=b.find("#scope_error"),S=b.find('select[name="team1"]'),z=b.find("#team1_container"),O=b.find("#team1_error"),B=b.find('select[name="team2"]'),F=b.find("#team2_container"),q=b.find("#team2_error"),L=b.find("#teamsRow"),I=b.find('select[name="pick"]'),H=b.find("#pick_container"),Y=H.find("label"),X=b.find("#pick_error"),J=b.find('select[name="odd_doubleParam"]'),V=b.find("#odd_doubleParam_container"),G=V.find("label"),W=b.find("#odd_doubleParam_error"),U=b.find('select[name="odd_doubleParam2"]'),K=b.find("#odd_doubleParam2_container"),Q=b.find("#odd_doubleParam2_error"),Z=b.find('select[name="odd_doubleParam3"]'),ee=b.find("#odd_doubleParam3_container"),te=b.find("#odd_doubleParam3_error"),ae=b.find('select[name="odd_participantParameterName"]'),re=b.find("#odd_participantParameterName_container"),ne=re.find("label"),oe=b.find("#odd_participantParameterName_error"),se=b.find("#bookmaker_container"),ie=b.find('select[name="bookmaker"]'),le=b.find("#bookmaker_error"),de=b.find('input[name="odd_value"]'),ce=b.find("#odd_error"),ue=b.find("#odd_container"),pe=(b.find("#liveContainer"),b.find("#live")),me=b.find('input[name="score"]'),he=b.find("#score_error"),fe=b.find("#score_container"),ge=$("#competition_hr_container"),ve=$("#market_scope_hr_container"),be=($("#marketParams_hr_container"),$("#bookmaker_hr_container")),_e=$("#live_hr_container"),Ce=$("#add_selection_manual_button_container");ie.select2({allowClear:!0,placeholder:"Choisir un bookmaker",cache:!0,ajax:{url:"all-bookmakers-on-autocomplete",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),$.fn.modal.Constructor.prototype.enforceFocus=function(){},$.fn.datetimepicker.dates.fr={days:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],daysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],daysMin:["D","L","Ma","Me","J","V","S","D"],months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthsShort:["Jan","Fev","Mar","Avr","Mai","Jui","Jul","Aou","Sep","Oct","Nov","Dec"],today:"Aujourd'hui",suffix:[],meridiem:"",weekStart:1},_.datetimepicker({format:"dd/mm/yyyy hh:ii",todayBtn:!0,autoclose:"true",language:"fr",pickerPosition:"bottom-left"}),p(),l(),t(),a(),r(),n(),o(),s(),i(),e()}function startDecompteRefresh(){function e(){r=10,n=setInterval(a,1e3),setTimeout(t,11e3)}function t(){$("#automatic-refresh").html("Rafraichissement auto !!"),clearInterval(n),refreshSelections(),e()}function a(){$("#automatic-refresh").html("Rafraichissement auto dans "+r+" secondes"),r--}var r=10,n=null;e()}function refreshSelections(){var e=$("#automaticform-add"),t=1;$.ajax({url:"selections",success:function(a){e.find("#automatic-selections").html(decodeURIComponent(a.vue)),supprimerSelection(),misAjourCompteBookmaker(),a.count>1&&(e.find("#automatic-selections").find('input[name="automatic-selection-cote[]"]').each(function(){t*=$(this).val()}),e.find("#automatic-selections table tbody").append('<tr><td></td><td>Cote combiné</td><td><input class=" form-control input-coupon-odd" name="total-cote-combine" type="text" value="'+Math.round(100*t)/100+'"></td><td></td></tr>'))},error:function(t){e.find("#automatic-selections").html("<p>impossible de récuperer les selections</p>")}})}function refreshSelectionsClick(){$("#refresh-panier-selection-on-click").on("click",function(e){e.preventDefault(),refreshSelections()})}function openOrCloseSelectionsCouponAccordeonWhenSelectionsCouponIsRefreshed(e){e>0?$("#panier-selections-add-ticket").collapse("show"):$("#panier-selections-add-ticket").hasClass("in")||$("#panier-selections-add-ticket").collapse("hide")}function supprimerSelection(){var e=$("#automaticform-add");e.find("#automatic-selections .boutonsupprimer").on("click",function(e){e.preventDefault();var t=$(this).parents("tr"),a=t.find(".selection_id").text();$.ajax({url:"coupon/"+a,method:"delete",success:function(e){refreshSelections()}})})}function misAjourCompteBookmaker(){$.ajax({url:"bettor/update-bookmaker-account-on-form",success:function(e){$("#automaticform-add").find("#accountsinputdashboard").html(""),e.length>0?$("#automaticform-add").find("#accountsinputdashboard").select2({data:e,minimumResultsForSearch:1/0}).val(e[0].id).trigger("change"):$("#automaticform-add").find("#accountsinputdashboard").select2({minimumResultsForSearch:1/0,placeholder:"Choisir un compte de bookmaker"}).val("").trigger("change").html("")}})}function gestionTicket(){function e(){M.hide(),a(),P.on("click",function(){$(this).is(":checked")?(y.removeClass("hide"),x.val(null).trigger("change").prop("disabled",!1),w.val(null).trigger("change").prop("disabled",!1)):(y.addClass("hide"),x.val(null).trigger("change").prop("disabled",!0),w.val(null).trigger("change").prop("disabled",!0))})}function t(){var e=c.find('button[type="submit"]');e.click(function(e){e.preventDefault();var t=Ladda.create(this),r=c.serialize(),n=c.find(".betline").length;if(""==n)swal({title:"Erreur!",text:"Ajoutez au moins une selection pour pouvoir valider le pari!",type:"warning",confirmButtonText:"OK"});else if(n>=1){var o,s;o=P.is(":checked")?1:0,s=D.is(":checked")?1:0;var i=[];$("#automaticform-add").find('input[name="optionlt[]"]').each(function(){i.push($(this).is(":checked")?1:0)}),t.start(),$.ajax({url:"encourspari/auto",type:"post",data:r+"&linesnum="+n+"&ticketABCD="+o+"&ticketLongTerme="+s,dataType:"json",success:function(e){var t;if(0==e.etat)if($.isArray(e.msg))for(key in e.msg)t=key,toastr.error(e.msg[t],"Erreur:");else toastr.error(e.msg,"Erreur:");else 1==e.etat&&(p.val(null).trigger("change"),a(),refreshSelections(),loadNeededWhenAddToCurrentBets(),toastr.success(e.msg,"Pari"))},error:function(e){console.log("erreur ajout de pari")},complete:function(){t.stop()}})}})}function a(){m.val(null).trigger("change"),h.val(null),f.val("u").trigger("change"),b.val(0).prop("disabled",!0),C.val(0).prop("disabled",!0),v.val(0),k.val(null).trigger("change").html("").prop("disabled",!0),y.addClass("hide"),x.val(null).trigger("change").prop("disabled",!0),w.val(null).trigger("change").prop("disabled",!0),E.addClass("hidden"),A.addClass("hidden"),N.addClass("hidden"),j.fadeOut(),r()}function r(){P.prop("checked",!1),P.parents("span").removeClass("checked"),T.prop("checked",!1),T.parents("span").removeClass("checked"),D.prop("checked",!1),D.parents("span").removeClass("checked")}function n(){p.select2({allowClear:!0,placeholder:"Choisir un tipster",cache:!0,ajax:{url:"ajax/tipsters",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).on("change",function(){var e=p.select2("data");if(b.val(0),C.val(0),v.val(0),""==p.val())a(),m.val(null).trigger("change"),h.val(null),E.addClass("hidden"),A.addClass("hidden"),N.addClass("hidden"),M.fadeOut(),R.text("");else{var t=2,r=0===t?1:Math.pow(10,t);R.animateNumber({number:e[0].montant_par_unite*r,numberStep:function(e,a){var n=Math.floor(e)/r,o=$(a.elem);t>0&&(n=n.toFixed(t)),o.text(parseFloat(n))}}),M.fadeIn(),j.fadeIn(),E.fadeIn().removeClass("hidden"),A.fadeIn().removeClass("hidden"),N.fadeIn().removeClass("hidden"),"n"==e[0].followtype?(m.val("n").trigger("change"),k.prop("disabled",!1),A.removeClass("hidden"),misAjourCompteBookmaker()):"b"==e[0].followtype&&(m.val("b").trigger("change"),k.prop("disabled",!0),A.addClass("hidden"))}var n=Number(e[0].montant_par_unite);h.val(isNaN(n)?"":n)})}function o(){m.on("change",function(){""!=p.val()&&("n"==m.val()?(k.prop("disabled",!1),A.fadeIn().removeClass("hidden")):(k.prop("disabled",!0),A.fadeOut().addClass("hidden")))}),m.select2({cache:!0,minimumResultsForSearch:1/0,data:[{id:"n",text:"normal"},{id:"b",text:"à blanc"}]})}function s(){var e=[{id:"u",text:"en unités"},{id:"f",text:"libre (devise)"}];f.select2({minimumResultsForSearch:1/0,cache:!0,data:e}),_.hide(),f.on("change",function(){"f"==f.val()?(v.val(0).prop("disabled",!0),b.val(0),C.val(0).prop("disabled",!1),g.hide(),_.show()):(C.val(0).prop("disabled",!0),v.val(0).prop("disabled",!1),b.val(0),g.show(),_.hide())})}function i(){k.select2({allowClear:!0,placeholder:"Choisir un compte",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"accounts",dataType:"json",data:function(e){return{book_id:$(u+" .bookinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}})}function l(){x.select2({allowClear:!0,placeholder:"Choisir une serie",tags:!0,cache:!0,ajax:{url:"parisabcd",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),w.select2({allowClear:!0,placeholder:"Choisir une lettre",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"lettreabcd",dataType:"json",data:function(e){return{serie_nom:x.val(),q:e.term}},processResults:function(e){console.log(e);var t=[];return $.each(e,function(e,a){t.push({id:a,text:a})}),{results:t}}}})}function d(){v.keyup(function(){var e=h.val(),t=Number(v.val()),a=Number(e)*Number(t),r=Math.round(100*a)/100;b.val(isNaN(r)||0>r?0:r)})}var c=$("#automaticform-add"),u="#automaticform-add",p=c.find("#tipstersinputdashboard"),m=c.find("#followtypeinputdashboard"),h=c.find("#amountperunit"),f=c.find("#typestakeinputdashboard"),g=c.find(".typestakeunites"),v=c.find("#stakeunitinputdashboard"),b=c.find("#amountconversion"),_=c.find(".typestakeflat"),C=c.find("#amountinputdashboard"),k=c.find("#accountsinputdashboard"),y=c.find("#methodeabcdcontainer"),x=c.find("#serieinputdashboard"),w=c.find("#letterinputdashboard"),P=c.find("#ticketABCD"),T=c.find("#ticketGratuit"),D=c.find("#ticketLongTerme"),E=c.find("#optionscontainer"),A=c.find("#bookmakercontainer"),N=c.find("#typestakecontainer"),j=c.find("#submitboutoncontainer"),M=$("#montant-par-unite-span"),R=$("#montant-par-unite-value");e(),refreshSelectionsClick(),refreshSelections(),t(),n(),o(),s(),d(),i(),l()}function automaticBetForm(){function e(){d.submit(function(e){e.preventDefault();var a=$(this).serialize(),r=d.find(".betline").length;if(""==r)swal({title:"Erreur!",text:"Ajoutez au moins une selection pour pouvoir valider le ticket!",type:"warning",confirmButtonText:"OK"});else if(r>=1){var n,o,i;n=p.is(":checked")?1:0,o=m.is(":checked")?1:0,console.log(p.is(":checked")),i=h.is(":checked")?1:0,$.ajax({url:"encourspari/auto",type:"post",data:a+"&linesnum="+r+"&ticketABCD="+n+"&ticketGratuit="+o+"&ticketLongTerme="+i,dataType:"json",success:function(e){var a;if(0==e.etat)if($.isArray(e.msg))for(key in e.msg)a=key,toastr.error(e.msg[a],"Erreur:");else toastr.error(e.msg,"Erreur:");else 1==e.etat&&(s(),t(),toastr.success(e.msg,"Pari"),loadParisEnCours(),loadBookmakersOnDashboard())},error:function(e){console.log("erreur ajout de pari")}})}})}function t(){var e=u.val();$.ajax({url:"selections",success:function(t){d.find("#automatic-selections").html(t.vue),a(),$.ajax({url:"allbookmakers",dataType:"json",success:function(a){d.find(".bookinputdashboard").select2({minimumResultsForSearch:1/0,cache:!0,data:a}),"à blanc"==e?(d.find(".bookinputdashboard").val("").trigger("change"),d.find("#accountsinputdashboard").val("").trigger("change")):(d.find(".bookinputdashboard").prop("disabled",!1),d.find("#accountsinputdashboard").prop("disabled",!1),d.find(".bookinputdashboard").val(t.bookmaker_id).trigger("change")),o(t.bookmaker_id)}}),t.msg.length>0&&swal({title:"Erreur!",text:t.msg,type:"warning",confirmButtonText:"OK"})},error:function(e){d.find("#automatic-selections").html("<p>impossible de récuperer les selections</p>")}})}function a(){d.find("#automatic-selections .boutonsupprimer").on("click",function(e){e.preventDefault();var a=$(this).parents("tr"),r=a.find(".selection_id").text();$.ajax({url:"coupon/"+r,method:"delete",success:function(e){t(),d.find(".bookinputdashboard").val(null).trigger("change"),d.find('select[name="accountsinputdashboard"]').val(null).trigger("change")},error:function(e){}})})}function r(){d.find("#selection-refresh").click(function(e){e.preventDefault(),t()})}function n(){var e=d.find("select[name=typestakeinputdashboard]");d.find(".typestakeflat").hide(),e.on("change",function(){"f"==$(this).val()?(d.find("#stakeunitinputdashboard").val(0),d.find("#amountconversion").val(0),d.find("#amountinputdashboard").val(0),d.find("#flattounitconversion").val(0),d.find(".typestakeunites").hide(),d.find(".typestakeflat").show()):(d.find("#amountinputdashboard").val(0),d.find("#flattounitconversion").val(0),d.find("#stakeunitinputdashboard").val(0),d.find("#amountconversion").val(0),d.find(".typestakeunites").show(),d.find(".typestakeflat").hide())})}function o(e){d.find("#tipstersinputdashboard").select2({allowClear:!0,placeholder:"Choisir un tipster",cache:!0,ajax:{url:"tipsters",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){var e=$(this).select2("data");""==d.find("#tipstersinputdashboard").val()?(s(),d.find("#WithoutTipsterPart").fadeOut().addClass("hidden"),u.val(null).trigger("change"),d.find("#amountperunit").val("")):(d.find("#WithoutTipsterPart").fadeIn().removeClass("hidden"),"n"==e[0].followtype?u.val("n").trigger("change"):"b"==e[0].followtype&&u.val("b").trigger("change"));var t=Number(e[0].montant_par_unite);d.find("#amountperunit").val(isNaN(t)?"":t)}),u.select2({cache:!0,minimumResultsForSearch:1/0,data:[{id:"n",text:"normal"},{id:"b",text:"à blanc"}]}).prop("disabled",!0)}function s(){d.find("#stakeunitinputdashboard").val(null),d.find("#amountinputdashboard").val(null),d.find("#accountsinputdashboard").val(null).trigger("change"),d.find(".methodeabcdcontainer").addClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#amountconversion").val(0),d.find("#flattounitconversion").val(0),d.find("#amountinputdashboard").val(0),d.find("#stakeunitinputdashboard").val(0),i()}function i(){p.prop("checked",!1),p.parents("span").removeClass("checked"),m.prop("checked",!1),m.parents("span").removeClass("checked"),h.prop("checked",!1),h.parents("span").removeClass("checked")}function l(){console.log(u.val()),u.val("b").trigger("change"),d.find("#WithoutTipsterPart").addClass("hidden"),s(),d.find("#ticketABCD").on("click",function(){$(this).is(":checked")?(d.find(".methodeabcdcontainer").removeClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!1),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!1)):(d.find(".methodeabcdcontainer").addClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!0))})}var d=$("#automaticform-add"),c="#automaticform-add",u=d.find("#followtypeinputdashboard"),p=d.find("#ticketABCD"),m=d.find("#ticketGratuit"),h=d.find("#ticketLongTerme"),f=[{id:"u",text:"en unités"},{id:"f",text:"en devise"}];d.find("#typestakeinputdashboard").select2({minimumResultsForSearch:1/0,cache:!0,data:f}),d.find("#accountsinputdashboard").select2({allowClear:!0,placeholder:"Choisir un compte",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"accounts",dataType:"json",data:function(e){return{book_id:$(c+" .bookinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}}),d.find("#serieinputdashboard").select2({allowClear:!0,placeholder:"Choisir une serie",tags:!0,cache:!0,ajax:{url:"parisabcd",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),d.find("#letterinputdashboard").select2({allowClear:!0,placeholder:"Choisir une lettre",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"lettreabcd",dataType:"json",data:function(e){return{serie_nom:$(c+" #serieinputdashboard").val(),q:e.term}},processResults:function(e){console.log(e);var t=[];return $.each(e,function(e,a){t.push({id:a,text:a})}),{results:t}}}}),d.find("#stakeunitinputdashboard").keyup(function(){var e=$(c+" #amountperunit").val(),t=Number($(c+" #stakeunitinputdashboard").val()),a=Number(e)*Number(t),r=Math.round(100*a)/100;isNaN(r)||0>r?$(c+"#amountconversion").val("0"):$(c+" #amountconversion").val(r)}),d.find("#amountinputdashboard").keyup(function(){var e=$(c+" #amountperunit").val(),t=$(c+" #amountinputdashboard").val(),a=Number(t)/Number(e),r=Math.round(100*a)/100;$(c+" #flattounitconversion").val(isNaN(r)||0>r||""==e?"0":r)}),l(),r(),t(),e(),n()}function loadParisABCD(){var e=$("#onglet_paris_martingale").find("span");$.ajax({url:"dashboard/ajax/parisabcd",type:"get",success:function(t){$("#tab_15_3").html(t.vue);var a=$("#parismartingaletable"),r=document.createElement("th");r.className="table-checkbox";var n=document.createElement("td");n.innerHTML='<span class="row-details row-details-close"></span>';var o=document.createElement("td");o.innerHTML='<span class=""></span>',a.find("thead tr").each(function(){this.insertBefore(r,this.childNodes[0])}),a.find("tbody tr").each(function(){console.log($(this).data("nb-selections")),$(this).data("nb-selections")>1?this.insertBefore(n.cloneNode(!0),this.childNodes[0]):this.insertBefore(o.cloneNode(!0),this.childNodes[0])});var s=$("#parismartingaletable").dataTable({language:{processing:"Traitement en cours...",search:"Rechercher&nbsp;:",lengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",info:"Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",infoEmpty:"Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",infoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",infoPostFix:"",loadingRecords:"Chargement en cours...",zeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",emptyTable:"Aucune donnée disponible dans le tableau",paginate:{first:"Premier",previous:"Pr&eacute;c&eacute;dent",next:"Suivant",last:"Dernier"},aria:{sortAscending:": activer pour trier la colonne par ordre croissant",sortDescending:": activer pour trier la colonne par ordre décroissant"}},lengthMenu:[[5,15,20,100],[5,15,20,100]],pageLength:5,dom:"<'table-scrollable't><'row'<'col-md-5 col-sm-6'i><'col-md-7 col-sm-6'p>>"}),i=$("#parismartingaletable_wrapper");i.find(".dataTables_length select").select2(),a.on("click"," tbody td .row-details",function(){var e=$(this).parents("tr")[0],t=$(this).parents("tr").data("selections"),a=$(this).parents("tr").data("pari-type");s.fnIsOpen(e)?($(this).addClass("row-details-close").removeClass("row-details-open"),s.fnClose(e)):($(this).addClass("row-details-open").removeClass("row-details-close"),s.fnOpen(e,fnFormatDetailsForChildsParisEnCours(s,t,a),"details"))}),0==t.count_paris_abcd?e.text(""):e.html(t.count_paris_abcd),$('[data-toggle="tooltip"]').tooltip(),parisEnCoursEnclose(a,"m"),parisEnCoursDelete(a,"m")},error:function(e){$("#tab_15_3").html("<p>impossible de récuperer les paris ABCD</p>")}})}function loadParisEnCours(){var e=$("#onglet_paris_en_cours"),t=e.find("span");$.ajax({url:"dashboard/ajax/parisencours",type:"get",success:function(e){$("#tab_15_1").html(e.vue);var a=$("#parisencourstable"),r=document.createElement("th");r.className="table-checkbox";var n=document.createElement("td");n.innerHTML='<span class="row-details glyphicon glyphicon-chevron-down blue"></span>';var o=document.createElement("td");o.innerHTML='<span class="glyphicon glyphicon-minus"></span>',a.find("thead tr").each(function(){this.insertBefore(r,this.childNodes[0])}),a.find("tbody tr").each(function(){$(this).data("nb-selections")>1?this.insertBefore(n.cloneNode(!0),this.childNodes[0]):this.insertBefore(o.cloneNode(!0),this.childNodes[0])});var s=$("#parisencourstable").dataTable({language:{processing:"Traitement en cours...",search:"Rechercher&nbsp;:",lengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",info:"Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",
infoEmpty:"Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",infoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",infoPostFix:"",loadingRecords:"Chargement en cours...",zeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",emptyTable:"Aucune donnée disponible dans le tableau",paginate:{first:"Premier",previous:"Pr&eacute;c&eacute;dent",next:"Suivant",last:"Dernier"},aria:{sortAscending:": activer pour trier la colonne par ordre croissant",sortDescending:": activer pour trier la colonne par ordre décroissant"}},ordering:!1,lengthMenu:[[5,15,20,100],[5,15,20,100]],pageLength:5,dom:"<'table-scrollable't><'row'<'col-md-5 col-sm-6'i><'col-md-7 col-sm-6'p>>"}),i=$("#parisencourstable_wrapper");i.find(".dataTables_length select").select2(),a.on("click"," tbody td .row-details",function(){var e=$(this).parents("tr")[0],t=$(this).parents("tr").data("pari-type");if(s.fnIsOpen(e))$(this).addClass("glyphicon-chevron-down").removeClass("glyphicon-chevron-up"),s.fnClose(e);else{var r=$(this).parents("tr").data("pari-id");$.getJSON("encourspari/selectionpourcombine/"+$(this).parents("tr").data("pari-id"),function(n){$(this).addClass("glyphicon-chevron-up").removeClass("glyphicon-chevron-down"),s.fnOpen(e,fnFormatDetailsForChildsParisEnCours(s,$.parseJSON(n),t),"details"),a.find("tr[data-pari-id='"+r+"']").next("tr").find('select[name="status[]"]').each(function(){$(this).val($(this).data("defaut-value"))}).select2()})}}),$('select[name="status[]"]').each(function(){$(this).val($(this).data("defaut-value"))}).select2(),0==e.count_paris_encours?t.text(""):t.html(e.count_paris_encours),calculMontantRetourne(a),parisEnCoursEnclose(a,"c"),parisEnCoursDelete(a,"c"),$('.boutonvalider [data-pari-type="c"]').confirmation()},error:function(e){$("#tab_15_1").html("<p>impossible de récuperer les paris</p>")}})}function loadParisTermine(){$.ajax({url:"dashboard/ajax/paristermine",data:{page:1},type:"get",success:function(e){function t(e,t){var a='<table class="table table-condensed table-subrow-combine"><thead><tr class="uppercase"><th>date rencontre</th><th>sport</th><th>competition</th><th>rencontre</th><th>pari</th><th>cote</th><th>resultat</th><th>status</th></tr></thead><tbody>';return $.each(t,function(e,t){function r(){switch(t.status){case 0:return"N/A";case 1:return'<span class="bold fontsize15 font-green-sharp">gagné</span>';case 2:return'<span class="bold fontsize15 font-red-haze">perdu</span>';case 3:return'<span class="bold fontsize15 font-green-sharp">1/2 gagné</span>';case 4:return'<span class="bold fontsize15 font-red-haze">1/2 perdu</span>';case 5:return'<span class="bold fontsize15">Remboursé</span>';case 6:return'<span class="bold fontsize15 font-blue">cash out</span>'}}function n(){return""==t.resultat||null==t.resultat?"N/A":t.resultat}function o(){return""==t.score||null==t.score?"":"("+t.score+"LIVE!)"}var s;s=null==t.game_name?"N/A":'<span><img src="img/flags/'+t.equipe1.country.shortname+'.png" class="img-flag"> '+t.equipe1.name+' - </span><span><img src="img/flags/'+t.equipe2.country.shortname+'.png" class="img-flag"> '+t.equipe2.name+"</span>",a+="<tr><td>"+moment.tz(t.date_match,"Europe/Paris").tz(user.timezone).format("DD/MM/YYYY HH:mm")+"</td><td>"+t.sport.name+"</td><td>"+t.competition.name+"</td><td>"+s+"</td><td>"+t.pariAffichage+" ("+t.scope.representation+")"+o()+"</td><td>"+t.cote+"</td><td>"+n()+'</td><td class="uppercase">'+r()+"</td></tr>"}),a+="</tbody></table>"}$("#tab_15_4").html(e);var a=$("#paristerminetable"),r=document.createElement("th");r.className="table-checkbox";var n=document.createElement("td");n.innerHTML='<span class="row-details row-details-close"></span>',a.find("thead tr").each(function(){this.insertBefore(r,this.childNodes[0])}),a.find("tbody tr").each(function(){this.insertBefore(n.cloneNode(!0),this.childNodes[0])});var o=a.dataTable({language:{processing:"Traitement en cours...",search:"Rechercher&nbsp;:",lengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",info:"Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",infoEmpty:"Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",infoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",infoPostFix:"",loadingRecords:"Chargement en cours...",zeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",emptyTable:"Aucune donnée disponible dans le tableau",paginate:{first:"Premier",previous:"Pr&eacute;c&eacute;dent",next:"Suivant",last:"Dernier"},aria:{sortAscending:": activer pour trier la colonne par ordre croissant",sortDescending:": activer pour trier la colonne par ordre décroissant"}},lengthMenu:[[5,15,20,100],[5,15,20,100]],pageLength:5,dom:"<'row' <'col-md-6 col-sm-12 margin-bot'B>><'row'<'col-md-6 col-sm-6'l><'col-md-6 col-sm-6'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-6'i><'col-md-7 col-sm-6'p>>",buttons:["excelHtml5","csvHtml5",{extend:"pdfHtml5",orientation:"landscape",download:"open"}]}),s=$("#paristerminetable_wrapper");s.find(".dataTables_length select").select2(),a.on("click"," tbody td .row-details",function(){var e=$(this).parents("tr")[0],a=$(this).parents("tr").data("selections");o.fnIsOpen(e)?($(this).addClass("row-details-close").removeClass("row-details-open"),o.fnClose(e)):($(this).addClass("row-details-open").removeClass("row-details-close"),o.fnOpen(e,t(o,a),"details"))}),parisTermineDelete()},error:function(e){$("#tab_15_4").html("<p>impossible de récuperer les paris terminés</p>")}})}function featuresParisEnCours(){$('[data-toggle="tooltip"]').tooltip(),$("[data-hover='tooltip']").tooltip(),$("#parisencourstable .boutonvalider").click(function(e){e.stopPropagation()}),$("#parisencourstable .boutonsupprimer").click(function(e){e.stopPropagation()}),$("#parisencourstable .boutoncashout").click(function(e){e.stopPropagation()}),$("#parisencourstable .boutonshowticket").click(function(e){e.stopPropagation()}),$("select[name='resultatDashboardInput']").click(function(e){e.stopPropagation()}),parisEnCoursCalculateStatus("#parisencourstable"),parisEnCoursEnclose("#parisencourstable",".validerform","historique"),parisEnCoursDelete("#parisencourstable",".supprimerform","encourspari/")}function paginationParisEnCours(){$("#tab_15_1").on("click",".pagination a",function(e){e.preventDefault();var t=getPaginationSelectedPage($(this).attr("href"));$.ajax({url:"dashboard/ajax/parisencours",data:{page:t},success:function(e){$("#tab_15_1").html(e.vue),featuresParisEnCours()},error:function(e){console.log("erreur: pagination par click")}})})}function loadParisEnCoursWithPage(e){var t=$("#parisencourstable .id").length,a=$("#tab_15_1").find(".active").find("span").text();"delete"==e&&1==t&&(a-=1),a?$.ajax({url:"dashboard/ajax/parisencours",data:{page:a},type:"get",success:function(e){$("#tab_15_1").html(e),featuresParisEnCours()}}):loadParisEnCours()}function fnFormatDetailsForChildsParisEnCours(e,t,a){console.log(t);var r;return r='<table class="table table-condensed table-paris-child"><thead><tr class="uppercase"><th>date</th><th>sport</th><th>competition</th><th>pari</th><th>cote</th><th>status</th></tr></thead><tbody>',$.each(t,function(e,t){function a(){return""==t.score||null==t.score?"":t.score+" LIVE!"}var n;n=null==t.game_name?"":t.equipe1.name+" - "+t.equipe2.name+" / ",console.log(t.status),r+='<tr data-selection-id="'+t.id+'"><td>'+moment.tz(t.date_match,"Europe/Paris").tz(user.timezone).format("DD/MM/YYYY HH:mm")+"</td><td>"+t.sport.name+"</td><td>"+t.competition.name+"</td><td>"+n+'<span class="blue">'+t.pariAffichage+'</span> <span class="label label-sm label-danger label-mini">'+a()+"</span></td><td>"+parseFloat(Math.round(1e3*t.cote)/1e3)+'</td><td class=""><select name="status[]" data-value="" data-defaut-value="'+t.status+'" class="form-control inputs-ticket"><option value="0">-Choisir-</option><option value="1">Gagné</option><option value="2">Perdu</option><option value="3">1/2 Gagné</option><option value="4">1/2 Perdu</option><option value="5">Remboursé</option></select></td></tr>'}),r+="</tbody></table>"}function loadNeededWhenAddToHistory(){loadParisTermine(),loadBookmakersOnDashboard(),loadGeneralRecapsOnDashboard(),totalProfits()}function loadNeededWhenAddToCurrentBets(){loadParisEnCours(),loadParisLongTerme(),loadParisABCD(),loadBookmakersOnDashboard()}function cashOut(){var e=$("#cashoutModal");e.on("show.bs.modal",function(e){var t=$(e.relatedTarget).data("id");$(e.currentTarget).find('input[name="ticket-id"]').val(t)});var t=$("#cashout-update"),a=t.find("#cashout-select"),r=[{id:"c",text:"classic cash out"},{id:"p",text:"partial cash out"}];a.select2({minimumResultsForSearch:1/0,cache:!0,data:r}),t.submit(function(a){a.preventDefault();var r=t.serialize();$.ajax({url:"cashout",type:"post",data:r,dataType:"json",success:function(t){if(t.etat)toastr.success(t.msg,t.head),loadParisEnCours(),loadParisTermine(),loadBookmakersOnDashboard(),loadParisLongTerme(),loadGeneralRecapsOnDashboard(),e.hide();else for(key in t.msg)keyname=key,toastr.error(t.msg[keyname],"Erreur:")},error:function(){}})})}function loadParisLongTerme(){var e=$("#onglet_paris_long_terme").find("span");$.ajax({url:"dashboard/ajax/parislongterme",type:"get",success:function(t){$("#tab_15_2").html(t.vue);var a=$("#parislongtermetable"),r=document.createElement("th");r.className="table-checkbox";var n=document.createElement("td");n.innerHTML='<span class="row-details row-details-close"></span>';var o=document.createElement("td");o.innerHTML='<span class=""></span>',a.find("thead tr").each(function(){this.insertBefore(r,this.childNodes[0])}),a.find("tbody tr").each(function(){console.log($(this).data("nb-selections")),$(this).data("nb-selections")>1?this.insertBefore(n.cloneNode(!0),this.childNodes[0]):this.insertBefore(o.cloneNode(!0),this.childNodes[0])});var s=$("#parislongtermetable").dataTable({language:{processing:"Traitement en cours...",search:"Rechercher&nbsp;:",lengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",info:"Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",infoEmpty:"Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",infoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",infoPostFix:"",loadingRecords:"Chargement en cours...",zeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",emptyTable:"Aucune donnée disponible dans le tableau",paginate:{first:"Premier",previous:"Pr&eacute;c&eacute;dent",next:"Suivant",last:"Dernier"},aria:{sortAscending:": activer pour trier la colonne par ordre croissant",sortDescending:": activer pour trier la colonne par ordre décroissant"}},lengthMenu:[[5,15,20,100],[5,15,20,100]],pageLength:5,dom:"<'table-scrollable't><'row'<'col-md-5 col-sm-6'i><'col-md-7 col-sm-6'p>>"}),i=$("#parislongtermetable_wrapper");i.find(".dataTables_length select").select2(),a.on("click"," tbody td .row-details",function(){var e=$(this).parents("tr")[0],t=$(this).parents("tr").data("selections"),a=$(this).parents("tr").data("pari-type");s.fnIsOpen(e)?($(this).addClass("row-details-close").removeClass("row-details-open"),s.fnClose(e)):($(this).addClass("row-details-open").removeClass("row-details-close"),s.fnOpen(e,fnFormatDetailsForChildsParisEnCours(s,t,a),"details"))}),0==t.count_paris_longterme?e.text(""):e.html(t.count_paris_longterme),$('[data-toggle="tooltip"]').tooltip(),parisEnCoursEnclose(a,"lt"),parisEnCoursDelete(a,"lt")},error:function(e){console.log("le chargement des paris long terme n'a pas fonctionné")}})}function loadParisTermine(){$.ajax({url:"dashboard/ajax/paristermine",data:{page:1},type:"get",success:function(e){function t(e,t){var a='<table class="table table-condensed table-subrow-combine"><thead><tr class="uppercase"><th>date rencontre</th><th>sport</th><th>competition</th><th>rencontre</th><th>pari</th><th>cote</th><th>resultat</th><th>status</th></tr></thead><tbody>';return $.each(t,function(e,t){function r(){switch(t.status){case 0:return"N/A";case 1:return'<span class="bold fontsize15 font-green-sharp">gagné</span>';case 2:return'<span class="bold fontsize15 font-red-haze">perdu</span>';case 3:return'<span class="bold fontsize15 font-green-sharp">1/2 gagné</span>';case 4:return'<span class="bold fontsize15 font-red-haze">1/2 perdu</span>';case 5:return'<span class="bold fontsize15">Remboursé</span>';case 6:return'<span class="bold fontsize15 font-blue">cash out</span>'}}function n(){return""==t.resultat||null==t.resultat?"N/A":t.resultat}function o(){return""==t.score||null==t.score?"":"("+t.score+"LIVE!)"}var s;s=null==t.game_name?"N/A":'<span><img src="img/flags/'+t.equipe1.country.shortname+'.png" class="img-flag"> '+t.equipe1.name+' - </span><span><img src="img/flags/'+t.equipe2.country.shortname+'.png" class="img-flag"> '+t.equipe2.name+"</span>",a+="<tr><td>"+moment.tz(t.date_match,"Europe/Paris").tz(user.timezone).format("DD/MM/YYYY HH:mm")+"</td><td>"+t.sport.name+"</td><td>"+t.competition.name+"</td><td>"+s+"</td><td>"+t.pariAffichage+" ("+t.scope.representation+")"+o()+"</td><td>"+t.cote+"</td><td>"+n()+'</td><td class="uppercase">'+r()+"</td></tr>"}),a+="</tbody></table>"}$("#tab_15_4").html(e);var a=$("#paristerminetable"),r=document.createElement("th");r.className="table-checkbox";var n=document.createElement("td");n.innerHTML='<span class="row-details row-details-close"></span>';var o=document.createElement("td");o.innerHTML='<span class=""></span>',a.find("thead tr").each(function(){this.insertBefore(r,this.childNodes[0])}),a.find("tbody tr").each(function(){console.log($(this).data("nb-selections")),$(this).data("nb-selections")>1?this.insertBefore(n.cloneNode(!0),this.childNodes[0]):this.insertBefore(o.cloneNode(!0),this.childNodes[0])});var s=a.dataTable({language:{processing:"Traitement en cours...",search:"Rechercher&nbsp;:",lengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",info:"Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",infoEmpty:"Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",infoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",infoPostFix:"",loadingRecords:"Chargement en cours...",zeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",emptyTable:"Aucune donnée disponible dans le tableau",paginate:{first:"Premier",previous:"Pr&eacute;c&eacute;dent",next:"Suivant",last:"Dernier"},aria:{sortAscending:": activer pour trier la colonne par ordre croissant",sortDescending:": activer pour trier la colonne par ordre décroissant"}},lengthMenu:[[5,15,20,100],[5,15,20,100]],pageLength:5,dom:"<'row' <'col-md-6 col-sm-12 margin-bot'B>><'row'<'col-md-6 col-sm-6'l><'col-md-6 col-sm-6'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-6'i><'col-md-7 col-sm-6'p>>",buttons:["excelHtml5","csvHtml5",{extend:"pdfHtml5",orientation:"landscape",download:"open"}]}),i=$("#paristerminetable_wrapper");i.find(".dataTables_length select").select2(),a.on("click"," tbody td .row-details",function(){var e=$(this).parents("tr")[0],a=$(this).parents("tr").data("selections");s.fnIsOpen(e)?($(this).addClass("row-details-close").removeClass("row-details-open"),s.fnClose(e)):($(this).addClass("row-details-open").removeClass("row-details-close"),s.fnOpen(e,t(s,a),"details"))}),parisTermineDelete()},error:function(e){$("#tab_15_4").html("<p>impossible de récuperer les paris terminés</p>")}})}function calculMontantRetourne(e){e.on("change",'select[name="status[]"]',function(){{var e,t,a,r,n=$(this);$(this).closest("tr").data("selection-id")}if(n.closest("tr .details").length>0){var o=[],s=1,i=n.closest("tr.details");if(e=i.prev("tr"),t=e.find('input[name="amount-returned"]'),i.find('select[name="status[]"]').each(function(){var e=$(this),t=Number(e.closest("td").prev("td").text());console.log(t),o.push($(this).val()),s*=calcul_nouvelle_cote_par_rapport_a_status(t,$(this).val())}),a=e.find(".tdsubmise").text(),console.log("status="+o+" cote="+s+" mise="+a),o.indexOf("0")>-1&&-1==o.indexOf("2"))t.val(""),updateParisEnCours(o,e.data("pari-id"),t.val(),s);else if(o.indexOf("0")>-1&&o.indexOf("2")>-1)t.val(0),updateParisEnCours(o,e.data("pari-id"),t.val(),s);else{r=s*a;var l=2,d=0===l?1:Math.pow(10,l);t.animateNumber({number:r*d,numberStep:function(e,t){var a=Math.floor(e)/d,r=$(t.elem);l>0&&(a=a.toFixed(l)),r.prop("number",e).val(parseFloat(a))}},"normal",function(){updateParisEnCours(o,e.data("pari-id"),t.val(),s)})}}else{e=n.closest("tr"),t=e.find('input[name="amount-returned"]'),o=n.val();var c=e.find(".tdcote").text();if(a=e.find(".tdsubmise").text(),"0"==o)t.val("");else{var u=calcul_nouvelle_cote_par_rapport_a_status(c,o);r=u*a;var l=2,d=0===l?1:Math.pow(10,l);t.animateNumber({number:r*d,numberStep:function(e,t){var a=Math.floor(e)/d,r=$(t.elem);l>0&&(a=a.toFixed(l)),r.prop("number",e).val(parseFloat(a))}},"normal",function(){updateParisEnCours(o,e.data("pari-id"),t.val(),s)})}}})}function calcul_nouvelle_cote_par_rapport_a_status(e,t){var a=1;return 0==t?no_selection=!0:1==t?a*=e:2==t?(a*=0,perdu_selection=1):3==t?a*=[(e-1)/2+1]:4==t?a=.5*a:5==t&&(a+=0),a}function updateParisEnCours(e,t,a,r){$.ajax({method:"PUT",url:"encourspari/"+t,data:{status:e,montant_retour:a,cote_generale_apres_status:r},dataType:"json",success:function(){toastr.success("le status de la selection à ete mis à jour","Pari")},error:function(){toastr.error("Un problème est survenue, veuillez nous contacter pour résoudre le problème","Erreur")},complete:function(){}})}function parisEnCoursDelete(e,t){e.on("click",".boutonsupprimer",function(e){var a=$(this).data("pari-id"),r=Ladda.create(this);swal({title:"Supprimer le ticket",text:"Etes-vous sur?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Oui!",cancelButtonText:"Non, annuler",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(r.start(),$.ajax({url:"encourspari/"+a,type:"delete",success:function(e){0==e.etat?toastr.error(e.msg,"Suppression"):("lt"==t?loadParisLongTerme():"m"==t?loadParisABCD():"c"==t&&loadParisEnCours(),loadBookmakersOnDashboard(),toastr.success(e.msg,"Suppression"))},complete:function(){r.stop()}}))})})}function parisEnCoursEnclose(e,t){{var a=e;a.find(".boutonvalider")}a.on("click",".boutonvalider",function(e){e.preventDefault();var a=Ladda.create(this),r=$(this).closest("tr"),n=r.next("tr.details"),o=$(this).data("pari-type"),s=r.find('input[name="amount-returned"]').val(),i=[];"s"==o?i.push(r.find('select[name="status[]"]').val()):n.find('select[name="status[]"]').each(function(){i.push($(this).val())}),0==n.length&&"c"==o?swal("Erreur","Cliquez sur la croix pour dérouler le combiné et selectionnez les status pour chaque pari du combiné."):-1!=i.indexOf("0")&&-1==i.indexOf("2")?("s"==o&&swal("Erreur","Vous devez selectionnez un status !"),"c"==o&&swal("Erreur","Vous êtes obligé de selectionner le status pour chaque pari du combiné. Si vous souhaitez valider le combiné plus rapidement il faut qu'au moins un des paris ait le status 'perdu', les status des autres paris n'ont alors pas besoin d'être renseignés.")):(a.start(),$.ajax({url:"historique",type:"post",data:"status[]="+i+"&pari-id="+$(this).data("pari-id")+"&amount-returned="+s,dataType:"json",success:function(e){if(0==e.etat){var a="";$.each(e.msg,function(e,t){a+=t+"</br>"}),toastr.error(a,"Erreur:")}else toastr.success(e.msg,"Validation"),"lt"==t?loadParisLongTerme():"m"==t?loadParisABCD():"c"==t&&loadParisEnCours(),loadNeededWhenAddToHistory()},complete:function(){a.stop()}}))})}function parisTermineDelete(){var e=$("#paristerminetable");e.find(".bouton-supprimer-historique-pari").click(function(e){e.preventDefault();var t=$(this).data("id"),a=Ladda.create(this);swal({title:"Supprimer le pari",text:"Etes-vous sur?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Oui!",cancelButtonText:"Non, annuler",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(a.start(),$.ajax({url:"historique/"+t,type:"delete",success:function(e){0==e.etat?toastr.error(e.msg,"Suppression"):(toastr.success(e.msg,"Suppression"),loadParisTermine(),loadBookmakersOnDashboard(),loadGeneralRecapsOnDashboard())},complete:function(){a.stop()}}))})})}totalProfits(),getBookmakersForSelection(),loadParisEnCours(),loadParisLongTerme(),loadParisABCD(),loadParisTermine(),loadGeneralRecapsOnDashboard(),loadBookmakersOnDashboard(),cashOut(),gestionTicket(),addManualCouponSelection(),cb(moment.tz(user.timezone).startOf("month"),moment.tz(user.timezone).endOf("month")),$("#default-range-container").daterangepicker({opens:"left",format:"DD/MM/YYYY",buttonClasses:["btn btn-default"],applyClass:"btn-sm btn-primary",cancelClass:"btn-sm",locale:{applyLabel:"Choisir",cancelLabel:"Annuler",fromLabel:"De",toLabel:"à",customRangeLabel:"personnalisé",daysOfWeek:["L","Ma","Me","J","V","S","D"],monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],firstDay:1},ranges:{"Aujourd'hui":[moment.tz(user.timezone),moment.tz(user.timezone)],Hier:[moment.tz(user.timezone).subtract(1,"days"),moment.tz(user.timezone).subtract(1,"days")],"Cette Semaine":[moment.tz(user.timezone).startOf("isoweek"),moment.tz(user.timezone).endOf("isoweek")],"Semaine Précédente":[moment.tz(user.timezone).subtract(1,"week").startOf("isoweek"),moment.tz(user.timezone).subtract(1,"week").endOf("isoweek")],"Ce Mois-ci":[moment.tz(user.timezone).startOf("month"),moment.tz(user.timezone).endOf("month")],"Mois Précédent":[moment.tz(user.timezone).subtract(1,"month").startOf("month"),moment.tz(user.timezone).subtract(1,"month").endOf("month")]}},cb).on("apply.daterangepicker",function(e,t){loadGeneralRecapsOnDashboard()});var ranges_container=$(".ranges");ranges_container.find("ul li:nth-child(1)").removeClass("active"),ranges_container.find("ul li:nth-child(5)").addClass("active"),$("#WelcomeModal").modal({keyboard:!1,backdrop:"static"});