function loadBookmakersOnDashboard(){$.ajax({url:"comptes",type:"get",success:function(e){$("#comptes_par_bookmakers").html(e)},error:function(e){console.log("la récuperation des comptes bookmakers vers le dashboard n'a pas fonctionné")}})}function loadGeneralRecapsOnDashboard(){var e=$("#defaultrange input").val();$.ajax({url:"generalrecap",type:"get",data:{range:e},success:function(e){$("#tipsters-general-recap").html(e.tipsters_view),$("#total-recap-profits-devise").html(e.total_profit_devise),$("#total-recap-profits-unites").html(e.total_profit_unites)}})}function addManualCouponSelection(){function e(){M.hide(),V.hide(),Y.hide(),Q.hide(),ee.hide(),te.hide()}function a(){pe.click(function(){pe.is(":checked")?(he.show(),me.prop("disabled",!1),pe.parents("span").addClass("checked")):(he.hide(),me.prop("disabled",!0),pe.parents("span").removeClass("checked"))})}function r(){y.select2({allowClear:!0,placeholder:"Choisir un sport",cache:!0,ajax:{url:"sports",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){d(),P.val(null).trigger("change"),j.removeClass("has-error"),D.empty(),S.val(null).trigger("change"),R.removeClass("has-error"),T.empty()})}function t(){function e(e){if(!e.id)return e.text;var a=$('<span><img src="img/flags/'+e.country.shortname+'.png" class="img-flag" /> '+e.text+"</span>");return a}b.find(".competitioninputdashboard").select2({allowClear:!0,placeholder:"Choisir une competition",cache:!0,language:"fr",ajax:{url:"competitions",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e})}function o(){b.find(".marketinputdashboard").select2({allowClear:!0,placeholder:"Choisir un type de pari",cache:!0,ajax:{url:"markets",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){d(),$('[data-toggle="tooltip"]').tooltip();var e=S.val();7==e?(c(),V.fadeIn().show(),G.html("Vainqueur"+v),X.select2({tags:!0,allowClear:!0,placeholder:"Nom de l'équipe ou du joueur vainqueur"})):8==e?(u(),V.fadeIn().show(),X.select2({data:f,minimumResultsForSearch:1/0}),G.html("Résultat du match"),oe.text("Equipe Handicap"),te.fadeIn().show(),re.select2({data:h,minimumResultsForSearch:1/0,placeholder:"Equipe/Joueur"}),H.html("Handicap"+v),Y.fadeIn().show(),L.select2({tags:!0,allowClear:!0,placeholder:"2.5 ou -2.5"})):9==e?(m=[{id:"1X",text:"1X"},{id:"X2",text:"X2"},{id:"12",text:"12"}],M.fadeIn().show(),V.fadeIn().show(),X.select2({data:m,minimumResultsForSearch:1/0}),B.val("").trigger("change").prop("disabled",!1),N.val("").trigger("change").prop("disabled",!1),G.html("Choix")):11==e?(m=[{id:"1/1",text:"1/1"},{id:"1/X",text:"1/X"},{id:"1/2",text:"1/2"},{id:"X/1",text:"X/1"},{id:"X/X",text:"X/X"},{id:"X/2",text:"X/2"},{id:"2/1",text:"2/1"},{id:"2/X",text:"2/X"},{id:"2/2",text:"2/2"}],M.fadeIn().show(),V.fadeIn().show(),X.select2({data:m,minimumResultsForSearch:1/0}),B.val("").trigger("change").prop("disabled",!1),N.val("").trigger("change").prop("disabled",!1),G.html("Choix")):43==e?(M.fadeIn().show(),V.fadeIn().show(),G.html("Vainqueur"),X.select2({data:f,minimumResultsForSearch:1/0}),B.val("").trigger("change").prop("disabled",!1),N.val("").trigger("change").prop("disabled",!1)):46==e?(M.fadeIn().show(),V.fadeIn().show(),G.html("Vainqueur"),X.select2({data:h,minimumResultsForSearch:1/0}),B.val("").trigger("change").prop("disabled",!1),N.val("").trigger("change").prop("disabled",!1)):48==e&&(M.fadeIn().show(),B.val("").trigger("change").prop("disabled",!1),N.val("").trigger("change").prop("disabled",!1),V.fadeIn().show(),Y.show(),H.html("Handicap"+v),L.select2({placeholder:"-2.5 ou 2.5",tags:!0}),G.html("Equipe Handicap"),X.select2({data:h,minimumResultsForSearch:1/0}))})}function n(){z.select2({allowClear:!0,placeholder:"Choisir une portée",cache:!0,ajax:{url:"scopes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}})}function s(){b.find(".pickinputdashboard").select2()}function i(){function e(e){if(!e.id)return e.text;var a=$('<span><img src="img/flags/'+e.country.shortname+'.png" class="img-flag" /> '+e.text+"</span>");return a}b.find(".team1inputdashboard").select2({allowClear:!0,placeholder:"Equipe/Joueur Domicile",cache:!0,ajax:{url:"equipes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e}),b.find(".team2inputdashboard").select2({allowClear:!0,placeholder:"Equipe/Joueur Exterieur",cache:!0,ajax:{url:"equipes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e})}function l(){b.submit(function(e){e.preventDefault();var a,r=b.serialize();a=b.find("#live").is(":checked")?1:0,$.ajax({url:"manualcoupon",type:"post",data:r+"&live="+a,success:function(e){0==e.etat?(e.errors.date?(b.find("#date_container").addClass("has-error"),b.find("#date_error").html(e.errors.date)):(b.find("#date_container").removeClass("has-error"),b.find("#date_error").empty()),e.errors.sport?(b.find("#sport_container").addClass("has-error"),b.find("#sport_error").html(e.errors.sport)):(b.find("#sport_container").removeClass("has-error"),b.find("#sport_error").empty()),e.errors.competition?(b.find("#competition_container").addClass("has-error"),b.find("#competition_error").html(e.errors.competition)):(b.find("#competition_container").removeClass("has-error"),b.find("#competition_error").empty()),e.errors.market?(b.find("#market_container").addClass("has-error"),b.find("#market_error").html(e.errors.market)):(b.find("#market_container").removeClass("has-error"),b.find("#market_error").empty()),e.errors.scope?(b.find("#scope_container").addClass("has-error"),b.find("#scope_error").html(e.errors.scope)):(b.find("#scope_container").removeClass("has-error"),b.find("#scope_error").empty()),e.errors.team1?(b.find("#team1_container").addClass("has-error"),b.find("#team1_error").html(e.errors.team1)):(b.find("#team1_container").removeClass("has-error"),b.find("#team1_error").empty()),e.errors.team2?(b.find("#team2_container").addClass("has-error"),b.find("#team2_error").html(e.errors.team2)):(b.find("#team2_container").removeClass("has-error"),b.find("#team2_error").empty()),e.errors.pick?(b.find("#pick_container").addClass("has-error"),b.find("#pick_error").html(e.errors.pick)):(b.find("#pick_container").removeClass("has-error"),b.find("#pick_error").empty()),e.errors.odd_doubleParam?(b.find("#odd_doubleParam_container").addClass("has-error"),b.find("#odd_doubleParam_error").html(e.errors.odd_doubleParam)):(b.find("#odd_doubleParam_container").removeClass("has-error"),b.find("#odd_doubleParam_error").empty()),e.errors.odd_doubleParam2?(b.find("#odd_doubleParam2_container").addClass("has-error"),b.find("#odd_doubleParam2_error").html(e.errors.odd_doubleParam2)):(b.find("#odd_doubleParam2_container").removeClass("has-error"),b.find("#odd_doubleParam2_error").empty()),e.errors.odd_doubleParam3?(b.find("#odd_doubleParam3_container").addClass("has-error"),b.find("#odd_doubleParam3_error").html(e.errors.odd_doubleParam3)):(b.find("#odd_doubleParam3_container").removeClass("has-error"),b.find("#odd_doubleParam3_error").empty()),e.errors.bookmaker?(b.find("#bookmaker_container").addClass("has-error"),b.find("#bookmaker_error").html(e.errors.bookmaker)):(b.find("#bookmaker_container").removeClass("has-error"),b.find("#bookmaker_error").empty()),e.errors.odd_value?(b.find("#odd_container").addClass("has-error"),b.find("#odd_error").html(e.errors.odd_value)):(b.find("#odd_container").removeClass("has-error"),b.find("#odd_error").empty()),e.errors.score?(b.find("#score_container").addClass("has-error"),b.find("#score_error").html(e.errors.score)):(b.find("#score_container").removeClass("has-error"),b.find("#score_error").empty())):(refreshSelections(),p())}})})}function d(){c(),z.html("").val("").trigger("change"),E.removeClass("has-error"),O.empty(),X.html("").val("").trigger("change"),V.hide(),V.removeClass("has-error"),J.empty(),L.html("").val("").trigger("change"),Y.hide(),Y.removeClass("has-error"),W.empty(),K.html("").val("").trigger("change"),Q.hide(),Q.removeClass("has-error"),U.empty(),Z.html("").val("").trigger("change"),ee.hide(),ee.removeClass("has-error"),ae.empty(),re.html("").val("").trigger("change"),te.hide(),te.removeClass("has-error"),ne.empty()}function c(){M.hide(),B.val("").html('<option value=""></option>').trigger("change").prop("disabled",!0),N.val("").html('<option value=""></option>').trigger("change").prop("disabled",!0),q.removeClass("has-error"),I.empty(),F.removeClass("has-error"),A.empty()}function u(){M.show(),B.val("").html('<option value=""></option>').trigger("change").prop("disabled",!1),N.val("").html('<option value=""></option>').trigger("change").prop("disabled",!1)}function p(){k.val(null).trigger("change"),C.removeClass("has-error"),_.empty(),y.val(null).trigger("change"),x.removeClass("has-error"),w.empty(),P.val(null).trigger("change"),j.removeClass("has-error"),D.empty(),S.val(null).trigger("change"),R.removeClass("has-error"),T.empty(),z.val(null).trigger("change"),E.removeClass("has-error"),O.empty(),B.val(null).trigger("change"),q.removeClass("has-error"),I.empty(),N.val(null).trigger("change"),F.removeClass("has-error"),A.empty(),X.val(null).trigger("change"),V.removeClass("has-error"),J.empty(),L.val(null).trigger("change"),Y.removeClass("has-error"),W.empty(),K.val(null).trigger("change"),Q.removeClass("has-error"),U.empty(),Z.val(null).trigger("change"),ee.removeClass("has-error"),ae.empty(),re.val(null).trigger("change"),te.removeClass("has-error"),ne.empty(),de.val(null).trigger("change"),ue.removeClass("has-error"),ce.empty(),ie.val(null).trigger("change"),se.removeClass("has-error"),le.empty(),ie.val(null),he.removeClass("has-error").hide(),fe.empty(),me.val("").prop("disabled",!0),pe.parents("span").removeClass("checked"),pe.prop("checked",!1)}var m="",f=[{id:"1",text:"Home"},{id:"2",text:"Away"},{id:"X",text:"Draw"}],h=[{id:"1",text:"Home"},{id:"2",text:"Away"}],g="Quand cet icone apparait, aucune proposition vous sera faite, c'est à vous d'inscrire votre réponse dans le champ de recherche. Cette réponse deviendra ensuite une proposition, vous n'avez alors plus qu'à la selectionner.",v=" <span class='glyphicon glyphicon-save font-red' data-toggle='tooltip' data-title='"+g+"'></span>",b=($("#automaticform-add"),$("#manualselectionform-add")),k=($("#manualBetAddModal").modal("hide"),b.find('input[name="date"]')),C=b.find("#date_container"),_=b.find("#date_error"),y=b.find('select[name="sport"]'),x=b.find("#sport_container"),w=b.find("#sport_error"),P=b.find('select[name="competition"]'),j=b.find("#competition_container"),D=b.find("#competition_error"),S=b.find('select[name="market"]'),R=b.find("#market_container"),T=b.find("#market_error"),z=b.find('select[name="scope"]'),E=b.find("#scope_container"),O=b.find("#scope_error"),B=b.find('select[name="team1"]'),q=b.find("#team1_container"),I=b.find("#team1_error"),N=b.find('select[name="team2"]'),F=b.find("#team2_container"),A=b.find("#team2_error"),M=b.find("#teamsRow"),X=b.find('select[name="pick"]'),V=b.find("#pick_container"),G=V.find("label"),J=b.find("#pick_error"),L=b.find('select[name="odd_doubleParam"]'),Y=b.find("#odd_doubleParam_container"),H=Y.find("label"),W=b.find("#odd_doubleParam_error"),K=b.find('select[name="odd_doubleParam2"]'),Q=b.find("#odd_doubleParam2_container"),U=b.find("#odd_doubleParam2_error"),Z=b.find('select[name="odd_doubleParam3"]'),ee=b.find("#odd_doubleParam3_container"),ae=b.find("#odd_doubleParam3_error"),re=b.find('select[name="odd_participantParameterName"]'),te=b.find("#odd_participantParameterName_container"),oe=te.find("label"),ne=b.find("#odd_participantParameterName_error"),se=b.find("#bookmaker_container"),ie=b.find('select[name="bookmaker"]'),le=b.find("#bookmaker_error"),de=b.find('input[name="odd_value"]'),ce=b.find("#odd_error"),ue=b.find("#odd_container"),pe=(b.find("#liveContainer"),b.find("#live")),me=b.find('input[name="score"]'),fe=b.find("#score_error"),he=b.find("#score_container");ie.select2({allowClear:!0,placeholder:"Choisir un bookmaker",cache:!0,ajax:{url:"bookmakers",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),$.fn.modal.Constructor.prototype.enforceFocus=function(){},$.fn.datetimepicker.dates.fr={days:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],daysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],daysMin:["D","L","Ma","Me","J","V","S","D"],months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthsShort:["Jan","Fev","Mar","Avr","Mai","Jui","Jul","Aou","Sep","Oct","Nov","Dec"],today:"Aujourd'hui",suffix:[],meridiem:"",weekStart:1},k.datetimepicker({format:"dd/mm/yyyy hh:ii",todayBtn:!0,autoclose:"true",language:"fr",pickerPosition:"bottom-left"}),p(),l(),a(),r(),t(),o(),n(),s(),i(),e()}function startDecompteRefresh(){function e(){t=4,o=setInterval(r,1e3),setTimeout(a,5e3)}function a(){$("#automatic-refresh").html("- Rafraichissement auto !!"),clearInterval(o),refreshSelections(),e()}function r(){$("#automatic-refresh").html("- Rafraichissement auto dans "+t+" secondes"),t--}var t=4,o=null;e()}function refreshSelections(){var e=$("#automaticform-add");$.ajax({url:"selections",success:function(a){e.find("#automatic-selections").html(a.vue),supprimerSelection(),misAjourCompteBookmaker(),openOrCloseSelectionsCouponAccordeonWhenSelectionsCouponIsRefreshed(a.count)},error:function(a){e.find("#automatic-selections").html("<p>impossible de récuperer les selections</p>")}})}function openOrCloseSelectionsCouponAccordeonWhenSelectionsCouponIsRefreshed(e){e>0?($("#panier-selections-add-ticket").collapse("show"),$("#infos-generales-add-ticket").collapse("show")):($("#panier-selections-add-ticket").collapse("hide"),$("#infos-generales-add-ticket").collapse("hide"))}function supprimerSelection(){var e=$("#automaticform-add");e.find("#automatic-selections .boutonsupprimer").on("click",function(e){e.preventDefault();var a=$(this).parents("tr"),r=a.find(".selection_id").text();$.ajax({url:"coupon/"+r,method:"delete",success:function(e){refreshSelections()}})})}function misAjourCompteBookmaker(){$.ajax({url:"updateaccountform",success:function(e){$("#automaticform-add").find("#accountsinputdashboard").html(""),e.length>0?$("#automaticform-add").find("#accountsinputdashboard").select2({data:e,minimumResultsForSearch:1/0}).val(e[0].id).trigger("change"):$("#automaticform-add").find("#accountsinputdashboard").select2({minimumResultsForSearch:1/0,placeholder:"Choisir un compte de bookmaker"}).val("").trigger("change").html("")}})}function gestionTicket(){function e(){r(),P.on("click",function(){$(this).is(":checked")?(y.removeClass("hide"),x.val(null).trigger("change").prop("disabled",!1),w.val(null).trigger("change").prop("disabled",!1)):(y.addClass("hide"),x.val(null).trigger("change").prop("disabled",!0),w.val(null).trigger("change").prop("disabled",!0))})}function a(){c.submit(function(e){e.preventDefault(),m.prop("disabled",!1);var a=$(this).serialize(),t=c.find(".betline").length;if(""==t)swal({title:"Erreur!",text:"Ajoutez au moins une selection pour pouvoir valider le ticket!",type:"warning",confirmButtonText:"OK"});else if(t>=1){var o,n,s;o=P.is(":checked")?1:0,n=j.is(":checked")?1:0,s=D.is(":checked")?1:0,$.ajax({url:"encourspari/auto",type:"post",data:a+"&linesnum="+t+"&ticketABCD="+o+"&ticketGratuit="+n+"&ticketLongTerme="+s,dataType:"json",success:function(e){var a;if(0==e.etat)if(console.log(e.msg),console.log($.isArray(e.msg)),$.isArray(e.msg))for(key in e.msg)a=key,toastr.error(e.msg[a],"Erreur:");else toastr.error(e.msg,"Erreur:");else 1==e.etat&&(p.val(null).trigger("change"),r(),refreshSelections(),toastr.success(e.msg,"Pari"),loadParisEnCours(),loadBookmakersOnDashboard())},error:function(e){console.log("erreur ajout de pari")},complete:function(){m.prop("disabled",!0)}})}})}function r(){m.val(null).trigger("change").prop("disabled",!0),f.val(null),h.val("u").trigger("change"),b.val(0).prop("disabled",!0),C.val(0).prop("disabled",!0),v.val(0),_.val(null).trigger("change").html("").prop("disabled",!0),y.addClass("hide"),x.val(null).trigger("change").prop("disabled",!0),w.val(null).trigger("change").prop("disabled",!0),S.addClass("hidden"),R.addClass("hidden"),T.addClass("hidden"),t()}function t(){P.prop("checked",!1),P.parents("span").removeClass("checked"),j.prop("checked",!1),j.parents("span").removeClass("checked"),D.prop("checked",!1),D.parents("span").removeClass("checked")}function o(){c.find("#selection-refresh").click(function(e){e.preventDefault(),refreshSelections()})}function n(){p.select2({allowClear:!0,placeholder:"Choisir un tipster",cache:!0,ajax:{url:"tipsters",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){var e=p.select2("data");b.val(0),C.val(0),v.val(0),""==p.val()?(r(),m.val(null).trigger("change"),f.val(null),S.addClass("hidden"),R.addClass("hidden"),T.addClass("hidden")):(S.fadeIn().removeClass("hidden"),R.fadeIn().removeClass("hidden"),T.fadeIn().removeClass("hidden"),"n"==e[0].followtype?(m.val("n").trigger("change"),_.prop("disabled",!1),R.removeClass("hidden"),misAjourCompteBookmaker()):"b"==e[0].followtype&&(m.val("b").trigger("change"),_.prop("disabled",!0),R.addClass("hidden")));var a=Number(e[0].montant_par_unite);f.val(isNaN(a)?"":a)}),m.select2({cache:!0,minimumResultsForSearch:1/0,data:[{id:"",text:""},{id:"n",text:"normal"},{id:"b",text:"à blanc"}]}).prop("disabled",!0)}function s(){var e=[{id:"u",text:"en unités"},{id:"f",text:"en devise"}];h.select2({minimumResultsForSearch:1/0,cache:!0,data:e}),k.hide(),h.on("change",function(){"f"==h.val()?(v.val(0).prop("disabled",!0),b.val(0),C.val(0).prop("disabled",!1),g.hide(),k.show()):(C.val(0).prop("disabled",!0),v.val(0).prop("disabled",!1),b.val(0),g.show(),k.hide())})}function i(){_.select2({allowClear:!0,placeholder:"Choisir un compte",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"accounts",dataType:"json",data:function(e){return{book_id:$(u+" .bookinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}})}function l(){x.select2({allowClear:!0,placeholder:"Choisir une serie",tags:!0,cache:!0,ajax:{url:"parisabcd",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),w.select2({allowClear:!0,placeholder:"Choisir une lettre",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"lettreabcd",dataType:"json",data:function(e){return{serie_nom:x.val(),q:e.term}},processResults:function(e){console.log(e);var a=[];return $.each(e,function(e,r){a.push({id:r,text:r})}),{results:a}}}})}function d(){v.keyup(function(){var e=f.val(),a=Number(v.val()),r=Number(e)*Number(a),t=Math.round(100*r)/100;b.val(isNaN(t)||0>t?0:t)})}var c=$("#automaticform-add"),u="#automaticform-add",p=c.find("#tipstersinputdashboard"),m=c.find("#followtypeinputdashboard"),f=c.find("#amountperunit"),h=c.find("#typestakeinputdashboard"),g=c.find(".typestakeunites"),v=c.find("#stakeunitinputdashboard"),b=c.find("#amountconversion"),k=c.find(".typestakeflat"),C=c.find("#amountinputdashboard"),_=c.find("#accountsinputdashboard"),y=c.find("#methodeabcdcontainer"),x=c.find("#serieinputdashboard"),w=c.find("#letterinputdashboard"),P=c.find("#ticketABCD"),j=c.find("#ticketGratuit"),D=c.find("#ticketLongTerme"),S=c.find("#optionscontainer"),R=c.find("#bookmakercontainer"),T=c.find("#typestakecontainer");e(),o(),refreshSelections(),a(),n(),s(),d(),i(),l()}function automaticBetForm(){function e(){d.submit(function(e){e.preventDefault();var r=$(this).serialize(),t=d.find(".betline").length;if(""==t)swal({title:"Erreur!",text:"Ajoutez au moins une selection pour pouvoir valider le ticket!",type:"warning",confirmButtonText:"OK"});else if(t>=1){var o,n,i;o=p.is(":checked")?1:0,n=m.is(":checked")?1:0,console.log(p.is(":checked")),i=f.is(":checked")?1:0,$.ajax({url:"encourspari/auto",type:"post",data:r+"&linesnum="+t+"&ticketABCD="+o+"&ticketGratuit="+n+"&ticketLongTerme="+i,dataType:"json",success:function(e){var r;if(0==e.etat)if($.isArray(e.msg))for(key in e.msg)r=key,toastr.error(e.msg[r],"Erreur:");else toastr.error(e.msg,"Erreur:");else 1==e.etat&&(s(),a(),toastr.success(e.msg,"Pari"),loadParisEnCours(),loadBookmakersOnDashboard())},error:function(e){console.log("erreur ajout de pari")}})}})}function a(){var e=u.val();$.ajax({url:"selections",success:function(a){d.find("#automatic-selections").html(a.vue),r(),$.ajax({url:"allbookmakers",dataType:"json",success:function(r){d.find(".bookinputdashboard").select2({minimumResultsForSearch:1/0,cache:!0,data:r}),"à blanc"==e?(d.find(".bookinputdashboard").val("").trigger("change"),d.find("#accountsinputdashboard").val("").trigger("change")):(d.find(".bookinputdashboard").prop("disabled",!1),d.find("#accountsinputdashboard").prop("disabled",!1),d.find(".bookinputdashboard").val(a.bookmaker_id).trigger("change")),n(a.bookmaker_id)}}),a.msg.length>0&&swal({title:"Erreur!",text:a.msg,type:"warning",confirmButtonText:"OK"})},error:function(e){d.find("#automatic-selections").html("<p>impossible de récuperer les selections</p>")}})}function r(){d.find("#automatic-selections .boutonsupprimer").on("click",function(e){e.preventDefault();var r=$(this).parents("tr"),t=r.find(".selection_id").text();$.ajax({url:"coupon/"+t,method:"delete",success:function(e){a(),d.find(".bookinputdashboard").val(null).trigger("change"),d.find('select[name="accountsinputdashboard"]').val(null).trigger("change")},error:function(e){}})})}function t(){d.find("#selection-refresh").click(function(e){e.preventDefault(),a()})}function o(){var e=d.find("select[name=typestakeinputdashboard]");d.find(".typestakeflat").hide(),e.on("change",function(){"f"==$(this).val()?(d.find("#stakeunitinputdashboard").val(0),d.find("#amountconversion").val(0),d.find("#amountinputdashboard").val(0),d.find("#flattounitconversion").val(0),d.find(".typestakeunites").hide(),d.find(".typestakeflat").show()):(d.find("#amountinputdashboard").val(0),d.find("#flattounitconversion").val(0),d.find("#stakeunitinputdashboard").val(0),d.find("#amountconversion").val(0),d.find(".typestakeunites").show(),d.find(".typestakeflat").hide())})}function n(e){d.find("#tipstersinputdashboard").select2({allowClear:!0,placeholder:"Choisir un tipster",cache:!0,ajax:{url:"tipsters",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){var e=$(this).select2("data");""==d.find("#tipstersinputdashboard").val()?(s(),d.find("#WithoutTipsterPart").fadeOut().addClass("hidden"),u.val(null).trigger("change"),d.find("#amountperunit").val("")):(d.find("#WithoutTipsterPart").fadeIn().removeClass("hidden"),"n"==e[0].followtype?u.val("n").trigger("change"):"b"==e[0].followtype&&u.val("b").trigger("change"));var a=Number(e[0].montant_par_unite);d.find("#amountperunit").val(isNaN(a)?"":a)}),u.select2({cache:!0,minimumResultsForSearch:1/0,data:[{id:"n",text:"normal"},{id:"b",text:"à blanc"}]}).prop("disabled",!0)}function s(){d.find("#stakeunitinputdashboard").val(null),d.find("#amountinputdashboard").val(null),d.find("#accountsinputdashboard").val(null).trigger("change"),d.find(".methodeabcdcontainer").addClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#amountconversion").val(0),d.find("#flattounitconversion").val(0),d.find("#amountinputdashboard").val(0),d.find("#stakeunitinputdashboard").val(0),i()}function i(){p.prop("checked",!1),p.parents("span").removeClass("checked"),m.prop("checked",!1),m.parents("span").removeClass("checked"),f.prop("checked",!1),f.parents("span").removeClass("checked")}function l(){console.log(u.val()),u.val("b").trigger("change"),d.find("#WithoutTipsterPart").addClass("hidden"),s(),d.find("#ticketABCD").on("click",function(){$(this).is(":checked")?(d.find(".methodeabcdcontainer").removeClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!1),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!1)):(d.find(".methodeabcdcontainer").addClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!0))})}var d=$("#automaticform-add"),c="#automaticform-add",u=d.find("#followtypeinputdashboard"),p=d.find("#ticketABCD"),m=d.find("#ticketGratuit"),f=d.find("#ticketLongTerme"),h=[{id:"u",text:"en unités"},{id:"f",text:"en devise"}];d.find("#typestakeinputdashboard").select2({minimumResultsForSearch:1/0,cache:!0,data:h}),d.find("#accountsinputdashboard").select2({allowClear:!0,placeholder:"Choisir un compte",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"accounts",dataType:"json",data:function(e){return{book_id:$(c+" .bookinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}}),d.find("#serieinputdashboard").select2({allowClear:!0,placeholder:"Choisir une serie",tags:!0,cache:!0,ajax:{url:"parisabcd",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),d.find("#letterinputdashboard").select2({allowClear:!0,placeholder:"Choisir une lettre",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"lettreabcd",dataType:"json",data:function(e){return{serie_nom:$(c+" #serieinputdashboard").val(),q:e.term}},processResults:function(e){console.log(e);var a=[];return $.each(e,function(e,r){a.push({id:r,text:r})}),{results:a}}}}),d.find("#stakeunitinputdashboard").keyup(function(){var e=$(c+" #amountperunit").val(),a=Number($(c+" #stakeunitinputdashboard").val()),r=Number(e)*Number(a),t=Math.round(100*r)/100;isNaN(t)||0>t?$(c+"#amountconversion").val("0"):$(c+" #amountconversion").val(t)}),d.find("#amountinputdashboard").keyup(function(){var e=$(c+" #amountperunit").val(),a=$(c+" #amountinputdashboard").val(),r=Number(a)/Number(e),t=Math.round(100*r)/100;$(c+" #flattounitconversion").val(isNaN(t)||0>t||""==e?"0":t)}),l(),t(),a(),e(),o()}function loadParisEnCours(){{var e=$("#onglet_paris_en_cours"),a=e.find("span");$("#parisencourstable")}$.ajax({url:"dashboard/ajax/parisencours",data:{page:1},type:"get",success:function(e){$("#tab_15_1").html(e.vue),0==e.count_paris_encours?a.text(""):a.html(e.count_paris_encours),featuresParisEnCours(),paginationParisEnCours()},error:function(e){$("#tab_15_1").html("<p>impossible de récuperer les paris</p>")}})}function loadParisTermine(){var e=$("#paristerminetable");$.ajax({url:"dashboard/ajax/paristermine",data:{page:1},type:"get",success:function(a){$("#tab_15_4").html(a),parisTermineDelete(),e.find(".boutonsupprimer").click(function(e){e.stopPropagation()}),$(function(){$(".slimScrollTermine").slimScroll({height:"350px",allowPageScroll:!1,wheelStep:10,alwaysVisible:!0})}),$("#paristerminetable").tableSearch({})},error:function(e){$("#tab_15_4").html("<p>impossible de récuperer les paris terminés</p>")}})}function featuresParisEnCours(){$('[data-toggle="tooltip"]').tooltip(),$("[data-hover='tooltip']").tooltip(),$("#parisencourstable .boutonvalider").click(function(e){e.stopPropagation()}),$("#parisencourstable .boutonsupprimer").click(function(e){e.stopPropagation()}),$("#parisencourstable .boutoncashout").click(function(e){e.stopPropagation()}),$("#parisencourstable .boutonshowticket").click(function(e){e.stopPropagation()}),$("select[name='resultatDashboardInput']").click(function(e){e.stopPropagation()}),parisEnCoursCalculateStatus("#parisencourstable"),parisEnCoursEnclose("#parisencourstable",".validerform","historique"),parisEnCoursDelete("#parisencourstable",".supprimerform","encourspari/")}function paginationParisEnCours(){$("#tab_15_1").on("click",".pagination a",function(e){e.preventDefault();var a=getPaginationSelectedPage($(this).attr("href"));$.ajax({url:"dashboard/ajax/parisencours",data:{page:a},success:function(e){$("#tab_15_1").html(e.vue),featuresParisEnCours()},error:function(e){console.log("erreur: pagination par click")}})})}function loadParisEnCoursWithPage(e){var a=$("#parisencourstable .id").length,r=$("#tab_15_1").find(".active").find("span").text();"delete"==e&&1==a&&(r-=1),r?$.ajax({url:"dashboard/ajax/parisencours",data:{page:r},type:"get",success:function(e){$("#tab_15_1").html(e),featuresParisEnCours()}}):loadParisEnCours()}function cashOut(){var e=$("#cashoutModal");e.on("show.bs.modal",function(e){var a=$(e.relatedTarget).data("id");$(e.currentTarget).find('input[name="ticket-id"]').val(a)});var a=$("#cashout-update"),r=a.find("#cashout-select"),t=[{id:"c",text:"classic cash out"},{id:"p",text:"partial cash out"}];r.select2({minimumResultsForSearch:1/0,cache:!0,data:t}).change(function(){}),a.submit(function(r){r.preventDefault();var t=a.serialize();$.ajax({url:"cashout",type:"post",data:t,dataType:"json",success:function(a){if(a.etat)toastr.success(a.msg,a.head),loadParisEnCours(),loadParisTermine(),loadBookmakersOnDashboard(),loadParisLongTerme(),loadGeneralRecapsOnDashboard(),e.hide();else for(key in a.msg)keyname=key,toastr.error(a.msg[keyname],"Erreur:")},error:function(){}})})}function loadParisLongTerme(){$.ajax({url:"dashboard/ajax/parislongterme",data:{page:"1"},type:"get",success:function(e){$("#tab_15_2").html(e),$('[data-toggle="tooltip"]').tooltip(),$("#onglet_paris_long_terme span").text($("#parislongtermetable #count").text());{var a=($("#parislongtermetable"),$("#parislongtermetable .boutonvalider")),r=$("#parislongtermetable .boutonsupprimer"),t=$("#parislongtermetable .validerform"),o=$("#parislongtermetable .supprimerform"),n=$("#parislongtermetable select[name='resultatDashboardInput']");$("#parislongtermetable select[name='resultatDashboardInput'] option:selected")}$('[data-toggle="tooltip"]').tooltip(),a.click(function(e){e.stopPropagation()}),r.click(function(e){e.stopPropagation()}),n.click(function(e){e.stopPropagation()}),n.change(function(e){var a=$(this).closest(".mainrow"),r=a.find(".tdcote").text(),t=a.find(".tdmise .tdsubmise").text(),o=a.find(".tdretour span.subretour"),n=a.find(".tdretour");switch(result=a.find("select[name='resultatDashboardInput'] option:selected").text()){case"--Selectionnez--":o.empty(),n.css("color","black");break;case"Gagné":var s=parseFloat(t*r);n.css("color","green"),a.find(".tdretour span.subretour").text(s);break;case"Perdu":var s=parseFloat(t);n.css("color","red"),a.find(".tdretour span.subretour").text(s);break;case"1/2 Gagné":var s=parseFloat((t*r-t)/2)+parseFloat(t);n.css("color","green"),a.find(".tdretour span.subretour").text(s);break;case"1/2 Perdu":var s=parseFloat(t/2);n.css("color","red"),a.find(".tdretour span.subretour").text(s);break;case"Remboursé":n.css("color","black");var s=parseFloat(t);a.find(".tdretour span.subretour").text(s);break;case"Annulé":n.css("color","black");var s=parseFloat(t);a.find(".tdretour span.subretour").text(s)}}),t.submit(function(e){e.preventDefault();var a=$(this).closest(".mainrow"),r=a.find(".tdretour span.subretour");if(r.text().length>0){var t=a.find(".tdcote").text(),o=a.find(".tdmise .tdsubmise").text(),n=$(this).serialize();$.ajax({url:"historique",type:"post",data:n+"&cote="+t+"&mise="+o+"&retour="+r,success:function(e){loadParisLongTerme()},error:function(){console.log("valider un pari long terme ne fonctionne pas")}})}else alert("Vous devez préciser un status pour ce pari.")}),o.submit(function(e){e.preventDefault();{var a=$(this).closest(".mainrow"),r=a.find(".id").text();a.find(".tdretour span.subretour"),a.find(".tdcote").text(),
a.find(".tdmise .tdsubmise").text(),$(this).serialize()}confirm("Etes vous sur?")&&$.ajax({url:"historique/"+r,type:"delete",success:function(e){loadParisLongTerme()},error:function(){console.log("supprimer un pari long terme ne fonctionne pas")}})})},error:function(e){console.log("le chargement des paris long terme n'a pas fonctionné")}})}function calculProfits(e,a,r,t,o,n){var s,i,l=o,d=l,c=r,u=t,p=n,m=!1,f=!1,h=1,g="font-green-sharp",v="font-red-haze";if("simple"==e){var b=Number(c.find(".tdcote").text());0==a?s=1:1==a?h*=b:2==a?(h*=0,i=1):3==a?h*=[(b-1)/2+1]:4==a?h=.5*h:5==a&&(h+=0),s&&!i?(d="",m=!1,f=!0):(m=!0,d=h*l,d-=l,d=Number(Math.round(100*d)/100)),d>0?(u.addClass(g),p.addClass(g),u.removeClass(v),p.removeClass(v),u.removeClass("font-gray"),p.removeClass("font-gray")):0>d?(u.addClass(v),p.addClass(v),u.removeClass(g),p.removeClass(g),u.removeClass("font-gray"),p.removeClass("font-gray")):(u.addClass("font-gray"),p.addClass("font-gray"),u.removeClass(g),p.removeClass(g),u.removeClass(v),p.removeClass(v)),m?p.removeClass("hide"):p.addClass("hide"),d>0?f?u.html("+"+d):u.text("+"+d):f?u.html(d):u.text(d)}else c.find(".child-table-tr").each(function(){var e=Number($(this).find(".cote-td").text()),a=$(this).find('select[name="resultatSelectionDashboardInput[]"]').val();0==a?s=1:1==a?h*=e:2==a?(h*=0,i=1):3==a?h*=[(e-1)/2+1]:4==a?h=.5*h:5==a&&(h+=0)}),s&&!i?(d="",m=!1):(m=!0,d=h*l,d-=l,d=Number(Math.round(100*d)/100)),d>0?(u.addClass(g),p.addClass(g),u.removeClass(v),p.removeClass(v),u.removeClass("font-gray"),p.removeClass("font-gray")):0>d?(u.addClass(v),p.addClass(v),u.removeClass(g),p.removeClass(g),u.removeClass("font-gray"),p.removeClass("font-gray")):(u.addClass("font-gray"),p.addClass("font-gray"),u.removeClass(g),p.removeClass(g),u.removeClass(v),p.removeClass(v)),m?p.removeClass("hide"):p.addClass("hide"),u.text(d>0?"+"+d:d)}function statusBoutonValider(e,a,r){var t=a,o=r,n=new Array;if("simple"==e){var s=t.find('select[name="resultatSelectionDashboardInput[]"]').val();console.log(s),"0"==s?o.prop("disabled",!0):o.prop("disabled",!1)}else t.find(".child-table-tr").each(function(){var e=$(this).find('select[name="resultatSelectionDashboardInput[]"]').val();n.push(e)}),-1!==$.inArray("2",n)||-1==$.inArray("2",n)&&-1==$.inArray("0",n)?o.prop("disabled",!1):o.prop("disabled",!0)}function parisEnCoursCalculateStatus(e){$(e+" select[name='resultatSelectionDashboardInput[]']").change(function(){var a,r=($(e),$(this).closest(".mainrow")),t=$(this).val(),o=$(this).parents().hasClass("subrow");if(a=o?"combine":"simple","simple"==a){var a="S"==r.find(".type").text()?"simple":"",n=(r.find(".tdcote").text(),r.find(".tdsubmise").text()),s=r.find(".profits"),i=r.find(".devise"),l=r.find(".boutonvalider");statusBoutonValider(a,r,l),calculProfits(a,t,r,s,n,i)}else{var d=$(this).closest(".subrow"),c=d.prev(),a=c.find(".mainrow").text(),l=c.find(".boutonvalider"),u=$(this).closest(".child-table-tr"),n=(u.find(".child-id").text(),u.find('input[name="childrowsinput[]"]').val(),c.find(".tdsubmise").text()),s=c.find(".profits"),i=c.find(".devise");statusBoutonValider(a,d,l),calculProfits(a,"",d,s,n,i)}})}function parisEnCoursDelete(e,a,r){var t=($(e),$(a),r);$(e+" "+a).submit(function(e){e.preventDefault();{var a=$(this).closest(".mainrow"),r=a.find(".id").text();a.find(".tdretour span.subretour"),a.find(".tdcote").text(),a.find(".tdmise .tdsubmise").text(),$(this).serialize()}swal({title:"Supprimer le ticket",text:"Etes-vous sur?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Oui!",cancelButtonText:"Non, annuler",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&$.ajax({url:t+r,type:"delete",success:function(e){loadParisEnCours(),loadBookmakersOnDashboard(),0==e.etat?toastr.error(e.msg,"Suppression"):(toastr.success(e.msg,"Suppression"),loadBookmakersOnDashboard())},error:function(){console.log("supprimer un pari en cours ne fonctionne pas")}})})})}function parisEnCoursEnclose(e,a,r){var t=($(e),$(a),r);$(e+" "+a).submit(function(e){e.preventDefault();var a=$(this).closest(".mainrow"),r=($(this).closest(".wrapperRow"),a.find(".tdretour span.subretour"),a.find(".id").text()),o=[],n=[],s=(a.next().find(".child-row input"),a.find(".type").text());"S"==s?(o=a.find('select[name="resultatSelectionDashboardInput[]"]').serialize(),n=a.find('input[name="childrowsinput[]"]').serialize()):(o=a.next().find('select[name="resultatSelectionDashboardInput[]"]').serialize(),n=a.next().find('input[name="childrowsinput[]"]').serialize()),console.log(o),console.log(n),$.ajax({url:t,type:"post",data:o+"&"+n+"&ticket-id="+r,dataType:"json",success:function(e){0==e.etat?toastr.error(e.msg,"Validation"):(toastr.success(e.msg,"Validation"),loadParisEnCours(),loadParisTermine(),loadBookmakersOnDashboard(),loadGeneralRecapsOnDashboard())},error:function(){console.log("valider un pari en cours ne fonctionne pas")}})})}function parisTermineDelete(){var e="#paristerminetable",a=".supprimerform",r="historique/";$(e+" "+a).submit(function(e){e.preventDefault();var a=$(this).closest(".mainrow"),t=a.find(".id").text();swal({title:"Supprimer le ticket",text:"Etes-vous sur?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Oui!",cancelButtonText:"Non, annuler",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&$.ajax({url:r+t,type:"delete",success:function(e){0==e.etat?toastr.error(e.msg,"Suppression"):(toastr.success(e.msg,"Suppression"),loadParisTermine(),loadBookmakersOnDashboard(),loadGeneralRecapsOnDashboard())},error:function(){console.log("supprimer un pari en cours ne fonctionne pas")}})})})}parisEnCoursDelete(),getBookmakersForSelection(),loadParisEnCours(),cashOut(),loadParisLongTerme(),loadParisTermine(),loadGeneralRecapsOnDashboard(),loadBookmakersOnDashboard(),gestionTicket(),addManualCouponSelection(),$("#defaultrange").daterangepicker({opens:"left",format:"DD/MM/YYYY",ranges:{"Aujourd'hui":[moment.tz(user.timezone),moment.tz(user.timezone)],Hier:[moment.tz(user.timezone).subtract(1,"days"),moment.tz(user.timezone).subtract(1,"days")],"Cette Semaine":[moment.tz(user.timezone).startOf("isoweek"),moment.tz(user.timezone).endOf("isoweek")],"Semaine Précédente":[moment.tz(user.timezone).subtract(1,"week").startOf("isoweek"),moment.tz(user.timezone).subtract(1,"week").endOf("isoweek")],"Ce Mois":[moment.tz(user.timezone).startOf("month"),moment.tz(user.timezone).endOf("month")],"Mois Précédent":[moment.tz(user.timezone).subtract(1,"month").startOf("month"),moment.tz(user.timezone).subtract(1,"month").endOf("month")]}},function(e,a){$("#defaultrange input").val(e.format("DD/MM/YYYY")+" - "+a.format("DD/MM/YYYY"))}).on("apply.daterangepicker",function(e,a){loadGeneralRecapsOnDashboard()}),$("#WelcomeModal").modal({keyboard:!1,backdrop:"static"});