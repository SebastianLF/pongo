function loadBookmakersOnDashboard(){$.ajax({url:"bettor/comptes-for-dashboard",type:"get",success:function(e){$("#comptes_par_bookmakers").html(e)},error:function(e){console.log("la récuperation des comptes bookmakers vers le dashboard n'a pas fonctionné")}})}function loadGeneralRecapsOnDashboard(){var e=$("#defaultrange input").val();$.ajax({url:"generalrecap",type:"get",data:{range:e},success:function(e){$("#tipsters-general-recap").html(e.tipsters_view),$("#total-recap-profits-devise").html(e.total_profit_devise),$("#total-recap-profits-unites").html(e.total_profit_unites)}})}function addManualCouponSelection(){function e(){I.hide(),L.hide(),G.hide(),U.hide(),ee.hide(),re.hide()}function t(){pe.click(function(){pe.is(":checked")?(fe.show(),me.prop("disabled",!1),pe.parents("span").addClass("checked")):(fe.hide(),me.prop("disabled",!0),pe.parents("span").removeClass("checked"))})}function a(){y.select2({allowClear:!0,placeholder:"Choisir un sport",cache:!0,ajax:{url:"sports",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){d(),j.val(null).trigger("change"),T.removeClass("has-error"),P.empty(),R.val(null).trigger("change"),D.removeClass("has-error"),S.empty()})}function r(){function e(e){if(!e.id)return e.text;var t=$('<span><img src="img/flags/'+e.country.shortname+'.png" class="img-flag" /> '+e.text+"</span>");return t}b.find(".competitioninputdashboard").select2({allowClear:!0,placeholder:"Choisir une competition",cache:!0,language:"fr",ajax:{url:"competitions",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e})}function n(){b.find(".marketinputdashboard").select2({allowClear:!0,placeholder:"Choisir un type de pari",cache:!0,ajax:{url:"markets",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){d(),$('[data-toggle="tooltip"]').tooltip();var e=R.val();7==e?(c(),L.fadeIn().show(),X.html("Vainqueur"+v),Y.select2({tags:!0,allowClear:!0,placeholder:"Nom de l'équipe ou du joueur vainqueur"})):8==e?(u(),L.fadeIn().show(),Y.select2({data:h,minimumResultsForSearch:1/0}),X.html("Résultat du match"),ne.text("Equipe Handicap"),re.fadeIn().show(),ae.select2({data:f,minimumResultsForSearch:1/0,placeholder:"Equipe/Joueur"}),V.html("Handicap"+v),G.fadeIn().show(),J.select2({tags:!0,allowClear:!0,placeholder:"2.5 ou -2.5"})):9==e?(m=[{id:"1X",text:"1X"},{id:"X2",text:"X2"},{id:"12",text:"12"}],I.fadeIn().show(),L.fadeIn().show(),Y.select2({data:m,minimumResultsForSearch:1/0}),q.val("").trigger("change").prop("disabled",!1),O.val("").trigger("change").prop("disabled",!1),X.html("Choix")):11==e?(m=[{id:"1/1",text:"1/1"},{id:"1/X",text:"1/X"},{id:"1/2",text:"1/2"},{id:"X/1",text:"X/1"},{id:"X/X",text:"X/X"},{id:"X/2",text:"X/2"},{id:"2/1",text:"2/1"},{id:"2/X",text:"2/X"},{id:"2/2",text:"2/2"}],I.fadeIn().show(),L.fadeIn().show(),Y.select2({data:m,minimumResultsForSearch:1/0}),q.val("").trigger("change").prop("disabled",!1),O.val("").trigger("change").prop("disabled",!1),X.html("Choix")):43==e?(I.fadeIn().show(),L.fadeIn().show(),X.html("Vainqueur"),Y.select2({data:h,minimumResultsForSearch:1/0}),q.val("").trigger("change").prop("disabled",!1),O.val("").trigger("change").prop("disabled",!1)):46==e?(I.fadeIn().show(),L.fadeIn().show(),X.html("Vainqueur"),Y.select2({data:f,minimumResultsForSearch:1/0}),q.val("").trigger("change").prop("disabled",!1),O.val("").trigger("change").prop("disabled",!1)):48==e&&(I.fadeIn().show(),q.val("").trigger("change").prop("disabled",!1),O.val("").trigger("change").prop("disabled",!1),L.fadeIn().show(),G.show(),V.html("Handicap"+v),J.select2({placeholder:"-2.5 ou 2.5",tags:!0}),X.html("Equipe Handicap"),Y.select2({data:f,minimumResultsForSearch:1/0}))})}function o(){z.select2({allowClear:!0,placeholder:"Choisir une portée",cache:!0,ajax:{url:"scopes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}})}function s(){b.find(".pickinputdashboard").select2()}function i(){function e(e){if(!e.id)return e.text;var t=$('<span><img src="img/flags/'+e.country.shortname+'.png" class="img-flag" /> '+e.text+"</span>");return t}b.find(".team1inputdashboard").select2({allowClear:!0,placeholder:"Equipe/Joueur Domicile",cache:!0,ajax:{url:"equipes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e}),b.find(".team2inputdashboard").select2({allowClear:!0,placeholder:"Equipe/Joueur Exterieur",cache:!0,ajax:{url:"equipes",dataType:"json",data:function(e){return{sport_id:b.find(".sportinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}},templateResult:e})}function l(){b.submit(function(e){e.preventDefault();var t,a=b.serialize();t=b.find("#live").is(":checked")?1:0,$.ajax({url:"manualcoupon",type:"post",data:a+"&live="+t,success:function(e){0==e.etat?(e.errors.date?(b.find("#date_container").addClass("has-error"),b.find("#date_error").html(e.errors.date)):(b.find("#date_container").removeClass("has-error"),b.find("#date_error").empty()),e.errors.sport?(b.find("#sport_container").addClass("has-error"),b.find("#sport_error").html(e.errors.sport)):(b.find("#sport_container").removeClass("has-error"),b.find("#sport_error").empty()),e.errors.competition?(b.find("#competition_container").addClass("has-error"),b.find("#competition_error").html(e.errors.competition)):(b.find("#competition_container").removeClass("has-error"),b.find("#competition_error").empty()),e.errors.market?(b.find("#market_container").addClass("has-error"),b.find("#market_error").html(e.errors.market)):(b.find("#market_container").removeClass("has-error"),b.find("#market_error").empty()),e.errors.scope?(b.find("#scope_container").addClass("has-error"),b.find("#scope_error").html(e.errors.scope)):(b.find("#scope_container").removeClass("has-error"),b.find("#scope_error").empty()),e.errors.team1?(b.find("#team1_container").addClass("has-error"),b.find("#team1_error").html(e.errors.team1)):(b.find("#team1_container").removeClass("has-error"),b.find("#team1_error").empty()),e.errors.team2?(b.find("#team2_container").addClass("has-error"),b.find("#team2_error").html(e.errors.team2)):(b.find("#team2_container").removeClass("has-error"),b.find("#team2_error").empty()),e.errors.pick?(b.find("#pick_container").addClass("has-error"),b.find("#pick_error").html(e.errors.pick)):(b.find("#pick_container").removeClass("has-error"),b.find("#pick_error").empty()),e.errors.odd_doubleParam?(b.find("#odd_doubleParam_container").addClass("has-error"),b.find("#odd_doubleParam_error").html(e.errors.odd_doubleParam)):(b.find("#odd_doubleParam_container").removeClass("has-error"),b.find("#odd_doubleParam_error").empty()),e.errors.odd_doubleParam2?(b.find("#odd_doubleParam2_container").addClass("has-error"),b.find("#odd_doubleParam2_error").html(e.errors.odd_doubleParam2)):(b.find("#odd_doubleParam2_container").removeClass("has-error"),b.find("#odd_doubleParam2_error").empty()),e.errors.odd_doubleParam3?(b.find("#odd_doubleParam3_container").addClass("has-error"),b.find("#odd_doubleParam3_error").html(e.errors.odd_doubleParam3)):(b.find("#odd_doubleParam3_container").removeClass("has-error"),b.find("#odd_doubleParam3_error").empty()),e.errors.bookmaker?(b.find("#bookmaker_container").addClass("has-error"),b.find("#bookmaker_error").html(e.errors.bookmaker)):(b.find("#bookmaker_container").removeClass("has-error"),b.find("#bookmaker_error").empty()),e.errors.odd_value?(b.find("#odd_container").addClass("has-error"),b.find("#odd_error").html(e.errors.odd_value)):(b.find("#odd_container").removeClass("has-error"),b.find("#odd_error").empty()),e.errors.score?(b.find("#score_container").addClass("has-error"),b.find("#score_error").html(e.errors.score)):(b.find("#score_container").removeClass("has-error"),b.find("#score_error").empty())):(refreshSelections(),p())}})})}function d(){c(),z.html("").val("").trigger("change"),A.removeClass("has-error"),N.empty(),Y.html("").val("").trigger("change"),L.hide(),L.removeClass("has-error"),H.empty(),J.html("").val("").trigger("change"),G.hide(),G.removeClass("has-error"),W.empty(),K.html("").val("").trigger("change"),U.hide(),U.removeClass("has-error"),Q.empty(),Z.html("").val("").trigger("change"),ee.hide(),ee.removeClass("has-error"),te.empty(),ae.html("").val("").trigger("change"),re.hide(),re.removeClass("has-error"),oe.empty()}function c(){I.hide(),q.val("").html('<option value=""></option>').trigger("change").prop("disabled",!0),O.val("").html('<option value=""></option>').trigger("change").prop("disabled",!0),M.removeClass("has-error"),E.empty(),F.removeClass("has-error"),B.empty()}function u(){I.show(),q.val("").html('<option value=""></option>').trigger("change").prop("disabled",!1),O.val("").html('<option value=""></option>').trigger("change").prop("disabled",!1)}function p(){k.val(null).trigger("change"),_.removeClass("has-error"),C.empty(),y.val(null).trigger("change"),w.removeClass("has-error"),x.empty(),j.val(null).trigger("change"),T.removeClass("has-error"),P.empty(),R.val(null).trigger("change"),D.removeClass("has-error"),S.empty(),z.val(null).trigger("change"),A.removeClass("has-error"),N.empty(),q.val(null).trigger("change"),M.removeClass("has-error"),E.empty(),O.val(null).trigger("change"),F.removeClass("has-error"),B.empty(),Y.val(null).trigger("change"),L.removeClass("has-error"),H.empty(),J.val(null).trigger("change"),G.removeClass("has-error"),W.empty(),K.val(null).trigger("change"),U.removeClass("has-error"),Q.empty(),Z.val(null).trigger("change"),ee.removeClass("has-error"),te.empty(),ae.val(null).trigger("change"),re.removeClass("has-error"),oe.empty(),de.val(null).trigger("change"),ue.removeClass("has-error"),ce.empty(),ie.val(null).trigger("change"),se.removeClass("has-error"),le.empty(),ie.val(null),fe.removeClass("has-error").hide(),he.empty(),me.val("").prop("disabled",!0),pe.parents("span").removeClass("checked"),pe.prop("checked",!1)}var m="",h=[{id:"1",text:"Home"},{id:"2",text:"Away"},{id:"X",text:"Draw"}],f=[{id:"1",text:"Home"},{id:"2",text:"Away"}],g="Quand cet icone apparait, aucune proposition vous sera faite, c'est à vous d'inscrire votre réponse dans le champ de recherche. Cette réponse deviendra ensuite une proposition, vous n'avez alors plus qu'à la selectionner.",v=" <span class='glyphicon glyphicon-save font-red' data-toggle='tooltip' data-title='"+g+"'></span>",b=($("#automaticform-add"),$("#manualselectionform-add")),k=($("#manualBetAddModal").modal("hide"),b.find('input[name="date"]')),_=b.find("#date_container"),C=b.find("#date_error"),y=b.find('select[name="sport"]'),w=b.find("#sport_container"),x=b.find("#sport_error"),j=b.find('select[name="competition"]'),T=b.find("#competition_container"),P=b.find("#competition_error"),R=b.find('select[name="market"]'),D=b.find("#market_container"),S=b.find("#market_error"),z=b.find('select[name="scope"]'),A=b.find("#scope_container"),N=b.find("#scope_error"),q=b.find('select[name="team1"]'),M=b.find("#team1_container"),E=b.find("#team1_error"),O=b.find('select[name="team2"]'),F=b.find("#team2_container"),B=b.find("#team2_error"),I=b.find("#teamsRow"),Y=b.find('select[name="pick"]'),L=b.find("#pick_container"),X=L.find("label"),H=b.find("#pick_error"),J=b.find('select[name="odd_doubleParam"]'),G=b.find("#odd_doubleParam_container"),V=G.find("label"),W=b.find("#odd_doubleParam_error"),K=b.find('select[name="odd_doubleParam2"]'),U=b.find("#odd_doubleParam2_container"),Q=b.find("#odd_doubleParam2_error"),Z=b.find('select[name="odd_doubleParam3"]'),ee=b.find("#odd_doubleParam3_container"),te=b.find("#odd_doubleParam3_error"),ae=b.find('select[name="odd_participantParameterName"]'),re=b.find("#odd_participantParameterName_container"),ne=re.find("label"),oe=b.find("#odd_participantParameterName_error"),se=b.find("#bookmaker_container"),ie=b.find('select[name="bookmaker"]'),le=b.find("#bookmaker_error"),de=b.find('input[name="odd_value"]'),ce=b.find("#odd_error"),ue=b.find("#odd_container"),pe=(b.find("#liveContainer"),b.find("#live")),me=b.find('input[name="score"]'),he=b.find("#score_error"),fe=b.find("#score_container");ie.select2({allowClear:!0,placeholder:"Choisir un bookmaker",cache:!0,ajax:{url:"all-bookmakers-on-autocomplete",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),$.fn.modal.Constructor.prototype.enforceFocus=function(){},$.fn.datetimepicker.dates.fr={days:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],daysShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],daysMin:["D","L","Ma","Me","J","V","S","D"],months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthsShort:["Jan","Fev","Mar","Avr","Mai","Jui","Jul","Aou","Sep","Oct","Nov","Dec"],today:"Aujourd'hui",suffix:[],meridiem:"",weekStart:1},k.datetimepicker({format:"dd/mm/yyyy hh:ii",todayBtn:!0,autoclose:"true",language:"fr",pickerPosition:"bottom-left"}),p(),l(),t(),a(),r(),n(),o(),s(),i(),e()}function startDecompteRefresh(){function e(){r=4,n=setInterval(a,1e3),setTimeout(t,5e3)}function t(){$("#automatic-refresh").html("- Rafraichissement auto !!"),clearInterval(n),refreshSelections(),e()}function a(){$("#automatic-refresh").html("- Rafraichissement auto dans "+r+" secondes"),r--}var r=4,n=null;e()}function refreshSelections(){var e=$("#automaticform-add");$.ajax({url:"selections",success:function(t){e.find("#automatic-selections").html(t.vue),supprimerSelection(),misAjourCompteBookmaker(),openOrCloseSelectionsCouponAccordeonWhenSelectionsCouponIsRefreshed(t.count)},error:function(t){e.find("#automatic-selections").html("<p>impossible de récuperer les selections</p>")}})}function openOrCloseSelectionsCouponAccordeonWhenSelectionsCouponIsRefreshed(e){e>0?($("#panier-selections-add-ticket").collapse("show"),$("#infos-generales-add-ticket").collapse("show")):($("#panier-selections-add-ticket").collapse("hide"),$("#infos-generales-add-ticket").collapse("hide"))}function supprimerSelection(){var e=$("#automaticform-add");e.find("#automatic-selections .boutonsupprimer").on("click",function(e){e.preventDefault();var t=$(this).parents("tr"),a=t.find(".selection_id").text();$.ajax({url:"coupon/"+a,method:"delete",success:function(e){refreshSelections()}})})}function misAjourCompteBookmaker(){$.ajax({url:"bettor/update-bookmaker-account-on-form",success:function(e){$("#automaticform-add").find("#accountsinputdashboard").html(""),e.length>0?$("#automaticform-add").find("#accountsinputdashboard").select2({data:e,minimumResultsForSearch:1/0}).val(e[0].id).trigger("change"):$("#automaticform-add").find("#accountsinputdashboard").select2({minimumResultsForSearch:1/0,placeholder:"Choisir un compte de bookmaker"}).val("").trigger("change").html("")}})}function gestionTicket(){function e(){a(),j.on("click",function(){$(this).is(":checked")?(y.removeClass("hide"),w.val(null).trigger("change").prop("disabled",!1),x.val(null).trigger("change").prop("disabled",!1)):(y.addClass("hide"),w.val(null).trigger("change").prop("disabled",!0),x.val(null).trigger("change").prop("disabled",!0))})}function t(){var e=c.find('button[type="submit"]');e.click(function(e){e.preventDefault();var t=Ladda.create(this);m.prop("disabled",!1);var r=c.serialize(),n=c.find(".betline").length;if(""==n)swal({title:"Erreur!",text:"Ajoutez au moins une selection pour pouvoir valider le pari!",type:"warning",confirmButtonText:"OK"});else if(n>=1){var o,s,i;o=j.is(":checked")?1:0,s=T.is(":checked")?1:0,i=P.is(":checked")?1:0,t.start(),$.ajax({url:"encourspari/auto",type:"post",data:r+"&linesnum="+n+"&ticketABCD="+o+"&ticketGratuit="+s+"&ticketLongTerme="+i,dataType:"json",success:function(e){var t;if(0==e.etat)if(console.log(e.msg),console.log($.isArray(e.msg)),$.isArray(e.msg))for(key in e.msg)t=key,toastr.error(e.msg[t],"Erreur:");else toastr.error(e.msg,"Erreur:");else 1==e.etat&&(p.val(null).trigger("change"),a(),refreshSelections(),toastr.success(e.msg,"Pari"),loadParisEnCours(),loadBookmakersOnDashboard())},error:function(e){console.log("erreur ajout de pari")},complete:function(){m.prop("disabled",!0),t.stop()}})}})}function a(){m.val(null).trigger("change").prop("disabled",!0),h.val(null),f.val("u").trigger("change"),b.val(0).prop("disabled",!0),_.val(0).prop("disabled",!0),v.val(0),C.val(null).trigger("change").html("").prop("disabled",!0),y.addClass("hide"),w.val(null).trigger("change").prop("disabled",!0),x.val(null).trigger("change").prop("disabled",!0),R.addClass("hidden"),D.addClass("hidden"),S.addClass("hidden"),r()}function r(){j.prop("checked",!1),j.parents("span").removeClass("checked"),T.prop("checked",!1),T.parents("span").removeClass("checked"),P.prop("checked",!1),P.parents("span").removeClass("checked")}function n(){c.find("#selection-refresh").click(function(e){e.preventDefault(),refreshSelections()})}function o(){p.select2({allowClear:!0,placeholder:"Choisir un tipster",cache:!0,ajax:{url:"ajax/tipsters",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){var e=p.select2("data");b.val(0),_.val(0),v.val(0),""==p.val()?(a(),m.val(null).trigger("change"),h.val(null),R.addClass("hidden"),D.addClass("hidden"),S.addClass("hidden")):(R.fadeIn().removeClass("hidden"),D.fadeIn().removeClass("hidden"),S.fadeIn().removeClass("hidden"),"n"==e[0].followtype?(m.val("n").trigger("change"),C.prop("disabled",!1),D.removeClass("hidden"),misAjourCompteBookmaker()):"b"==e[0].followtype&&(m.val("b").trigger("change"),C.prop("disabled",!0),D.addClass("hidden")));var t=Number(e[0].montant_par_unite);h.val(isNaN(t)?"":t)}),m.select2({cache:!0,minimumResultsForSearch:1/0,data:[{id:"",text:""},{id:"n",text:"normal"},{id:"b",text:"à blanc"}]}).prop("disabled",!0)}function s(){var e=[{id:"u",text:"en unités"},{id:"f",text:"en devise"}];f.select2({minimumResultsForSearch:1/0,cache:!0,data:e}),k.hide(),f.on("change",function(){"f"==f.val()?(v.val(0).prop("disabled",!0),b.val(0),_.val(0).prop("disabled",!1),g.hide(),k.show()):(_.val(0).prop("disabled",!0),v.val(0).prop("disabled",!1),b.val(0),g.show(),k.hide())})}function i(){C.select2({allowClear:!0,placeholder:"Choisir un compte",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"accounts",dataType:"json",data:function(e){return{book_id:$(u+" .bookinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}})}function l(){w.select2({allowClear:!0,placeholder:"Choisir une serie",tags:!0,cache:!0,ajax:{url:"parisabcd",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),x.select2({allowClear:!0,placeholder:"Choisir une lettre",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"lettreabcd",dataType:"json",data:function(e){return{serie_nom:w.val(),q:e.term}},processResults:function(e){console.log(e);var t=[];return $.each(e,function(e,a){t.push({id:a,text:a})}),{results:t}}}})}function d(){v.keyup(function(){var e=h.val(),t=Number(v.val()),a=Number(e)*Number(t),r=Math.round(100*a)/100;b.val(isNaN(r)||0>r?0:r)})}var c=$("#automaticform-add"),u="#automaticform-add",p=c.find("#tipstersinputdashboard"),m=c.find("#followtypeinputdashboard"),h=c.find("#amountperunit"),f=c.find("#typestakeinputdashboard"),g=c.find(".typestakeunites"),v=c.find("#stakeunitinputdashboard"),b=c.find("#amountconversion"),k=c.find(".typestakeflat"),_=c.find("#amountinputdashboard"),C=c.find("#accountsinputdashboard"),y=c.find("#methodeabcdcontainer"),w=c.find("#serieinputdashboard"),x=c.find("#letterinputdashboard"),j=c.find("#ticketABCD"),T=c.find("#ticketGratuit"),P=c.find("#ticketLongTerme"),R=c.find("#optionscontainer"),D=c.find("#bookmakercontainer"),S=c.find("#typestakecontainer");e(),n(),refreshSelections(),t(),o(),s(),d(),i(),l()}function automaticBetForm(){function e(){d.submit(function(e){e.preventDefault();var a=$(this).serialize(),r=d.find(".betline").length;if(""==r)swal({title:"Erreur!",text:"Ajoutez au moins une selection pour pouvoir valider le ticket!",type:"warning",confirmButtonText:"OK"});else if(r>=1){var n,o,i;n=p.is(":checked")?1:0,o=m.is(":checked")?1:0,console.log(p.is(":checked")),i=h.is(":checked")?1:0,$.ajax({url:"encourspari/auto",type:"post",data:a+"&linesnum="+r+"&ticketABCD="+n+"&ticketGratuit="+o+"&ticketLongTerme="+i,dataType:"json",success:function(e){var a;if(0==e.etat)if($.isArray(e.msg))for(key in e.msg)a=key,toastr.error(e.msg[a],"Erreur:");else toastr.error(e.msg,"Erreur:");else 1==e.etat&&(s(),t(),toastr.success(e.msg,"Pari"),loadParisEnCours(),loadBookmakersOnDashboard())},error:function(e){console.log("erreur ajout de pari")}})}})}function t(){var e=u.val();$.ajax({url:"selections",success:function(t){d.find("#automatic-selections").html(t.vue),a(),$.ajax({url:"allbookmakers",dataType:"json",success:function(a){d.find(".bookinputdashboard").select2({minimumResultsForSearch:1/0,cache:!0,data:a}),"à blanc"==e?(d.find(".bookinputdashboard").val("").trigger("change"),d.find("#accountsinputdashboard").val("").trigger("change")):(d.find(".bookinputdashboard").prop("disabled",!1),d.find("#accountsinputdashboard").prop("disabled",!1),d.find(".bookinputdashboard").val(t.bookmaker_id).trigger("change")),o(t.bookmaker_id)}}),t.msg.length>0&&swal({title:"Erreur!",text:t.msg,type:"warning",confirmButtonText:"OK"})},error:function(e){d.find("#automatic-selections").html("<p>impossible de récuperer les selections</p>")}})}function a(){d.find("#automatic-selections .boutonsupprimer").on("click",function(e){e.preventDefault();var a=$(this).parents("tr"),r=a.find(".selection_id").text();$.ajax({url:"coupon/"+r,method:"delete",success:function(e){t(),d.find(".bookinputdashboard").val(null).trigger("change"),d.find('select[name="accountsinputdashboard"]').val(null).trigger("change")},error:function(e){}})})}function r(){d.find("#selection-refresh").click(function(e){e.preventDefault(),t()})}function n(){var e=d.find("select[name=typestakeinputdashboard]");d.find(".typestakeflat").hide(),e.on("change",function(){"f"==$(this).val()?(d.find("#stakeunitinputdashboard").val(0),d.find("#amountconversion").val(0),d.find("#amountinputdashboard").val(0),d.find("#flattounitconversion").val(0),d.find(".typestakeunites").hide(),d.find(".typestakeflat").show()):(d.find("#amountinputdashboard").val(0),d.find("#flattounitconversion").val(0),d.find("#stakeunitinputdashboard").val(0),d.find("#amountconversion").val(0),d.find(".typestakeunites").show(),d.find(".typestakeflat").hide())})}function o(e){d.find("#tipstersinputdashboard").select2({allowClear:!0,placeholder:"Choisir un tipster",cache:!0,ajax:{url:"tipsters",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}).change(function(){var e=$(this).select2("data");""==d.find("#tipstersinputdashboard").val()?(s(),d.find("#WithoutTipsterPart").fadeOut().addClass("hidden"),u.val(null).trigger("change"),d.find("#amountperunit").val("")):(d.find("#WithoutTipsterPart").fadeIn().removeClass("hidden"),"n"==e[0].followtype?u.val("n").trigger("change"):"b"==e[0].followtype&&u.val("b").trigger("change"));var t=Number(e[0].montant_par_unite);d.find("#amountperunit").val(isNaN(t)?"":t)}),u.select2({cache:!0,minimumResultsForSearch:1/0,data:[{id:"n",text:"normal"},{id:"b",text:"à blanc"}]}).prop("disabled",!0)}function s(){d.find("#stakeunitinputdashboard").val(null),d.find("#amountinputdashboard").val(null),d.find("#accountsinputdashboard").val(null).trigger("change"),d.find(".methodeabcdcontainer").addClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#amountconversion").val(0),d.find("#flattounitconversion").val(0),d.find("#amountinputdashboard").val(0),d.find("#stakeunitinputdashboard").val(0),i()}function i(){p.prop("checked",!1),p.parents("span").removeClass("checked"),m.prop("checked",!1),m.parents("span").removeClass("checked"),h.prop("checked",!1),h.parents("span").removeClass("checked")}function l(){console.log(u.val()),u.val("b").trigger("change"),d.find("#WithoutTipsterPart").addClass("hidden"),s(),d.find("#ticketABCD").on("click",function(){$(this).is(":checked")?(d.find(".methodeabcdcontainer").removeClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!1),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!1)):(d.find(".methodeabcdcontainer").addClass("hide"),d.find("#serieinputdashboard").val(null).trigger("change").prop("disabled",!0),d.find("#letterinputdashboard").val(null).trigger("change").prop("disabled",!0))})}var d=$("#automaticform-add"),c="#automaticform-add",u=d.find("#followtypeinputdashboard"),p=d.find("#ticketABCD"),m=d.find("#ticketGratuit"),h=d.find("#ticketLongTerme"),f=[{id:"u",text:"en unités"},{id:"f",text:"en devise"}];d.find("#typestakeinputdashboard").select2({minimumResultsForSearch:1/0,cache:!0,data:f}),d.find("#accountsinputdashboard").select2({allowClear:!0,placeholder:"Choisir un compte",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"accounts",dataType:"json",data:function(e){return{book_id:$(c+" .bookinputdashboard").val(),q:e.term}},processResults:function(e){return{results:e}}}}),d.find("#serieinputdashboard").select2({allowClear:!0,placeholder:"Choisir une serie",tags:!0,cache:!0,ajax:{url:"parisabcd",dataType:"json",data:function(e){return{q:e.term}},processResults:function(e){return{results:e}}}}),d.find("#letterinputdashboard").select2({allowClear:!0,placeholder:"Choisir une lettre",cache:!0,minimumResultsForSearch:1/0,ajax:{url:"lettreabcd",dataType:"json",data:function(e){return{serie_nom:$(c+" #serieinputdashboard").val(),q:e.term}},processResults:function(e){console.log(e);var t=[];return $.each(e,function(e,a){t.push({id:a,text:a})}),{results:t}}}}),d.find("#stakeunitinputdashboard").keyup(function(){var e=$(c+" #amountperunit").val(),t=Number($(c+" #stakeunitinputdashboard").val()),a=Number(e)*Number(t),r=Math.round(100*a)/100;isNaN(r)||0>r?$(c+"#amountconversion").val("0"):$(c+" #amountconversion").val(r)}),d.find("#amountinputdashboard").keyup(function(){var e=$(c+" #amountperunit").val(),t=$(c+" #amountinputdashboard").val(),a=Number(t)/Number(e),r=Math.round(100*a)/100;$(c+" #flattounitconversion").val(isNaN(r)||0>r||""==e?"0":r)}),l(),r(),t(),e(),n()}function fnFormatDetailsForChildsParisEnCours(e,t,a){var r,n;return"c"==a?(r='<table class="table table-condensed table-paris-child"><thead><tr class="uppercase"><th>date rencontre</th><th>sport</th><th>competition</th><th>rencontre</th><th>pari</th><th>cote</th><th>status</th></tr></thead><tbody>',n='<td class="uppercase"><select name="status[]" data-value="" class="form-control inputs-ticket"><option value="0">-Choisir-</option><option value="1">Gagné</option><option value="2">Perdu</option><option value="3">1/2 Gagné</option><option value="4">1/2 Perdu</option><option value="5">Remboursé</option></select></td>'):"s"==a?(r='<table class="table table-condensed table-paris-child"><thead><tr class="uppercase"><th>date rencontre</th><th>sport</th><th>competition</th><th>rencontre</th><th>pari</th><th>cote</th></tr></thead><tbody>',n=""):r="",$.each(t,function(e,t){function a(){return""==t.score||null==t.score?"":"("+t.score+"LIVE!)"}var o;o=null==t.game_name?"N/A":'<span><img src="img/flags/'+t.equipe1.country.shortname+'.png" class="img-flag"> '+t.equipe1.name+' - </span><span><img src="img/flags/'+t.equipe2.country.shortname+'.png" class="img-flag"> '+t.equipe2.name+"</span>",r+="<tr><td>"+moment.tz(t.date_match,"Europe/Paris").tz(user.timezone).format("DD/MM/YYYY HH:mm")+"</td><td>"+t.sport.name+"</td><td>"+t.competition.name+"</td><td>"+o+"</td><td>"+t.pariAffichage+" ("+t.scope.representation+")"+a()+"</td><td>"+t.cote+"</td>"+n+"</tr>"}),r+="</tbody></table>"}function loadParisLongTerme(){var e=$("#onglet_paris_long_terme").find("span");$.ajax({url:"dashboard/ajax/parislongterme",type:"get",success:function(t){$("#tab_15_2").html(t.vue);var a=$("#parislongtermetable"),r=document.createElement("th");r.className="table-checkbox";var n=document.createElement("td");n.innerHTML='<span class="row-details row-details-close"></span>',a.find("thead tr").each(function(){this.insertBefore(r,this.childNodes[0])}),a.find("tbody tr").each(function(){this.insertBefore(n.cloneNode(!0),this.childNodes[0])});var o=$("#parislongtermetable").dataTable({language:{processing:"Traitement en cours...",search:"Rechercher&nbsp;:",lengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",info:"Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",infoEmpty:"Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",infoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",infoPostFix:"",loadingRecords:"Chargement en cours...",zeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",emptyTable:"Aucune donnée disponible dans le tableau",paginate:{first:"Premier",previous:"Pr&eacute;c&eacute;dent",next:"Suivant",last:"Dernier"},aria:{sortAscending:": activer pour trier la colonne par ordre croissant",sortDescending:": activer pour trier la colonne par ordre décroissant"}},lengthMenu:[[5,15,20,100],[5,15,20,100]],pageLength:5,dom:"<'table-scrollable't><'row'<'col-md-5 col-sm-6'i><'col-md-7 col-sm-6'p>>"}),s=$("#parislongtermetable_wrapper");s.find(".dataTables_length select").select2(),a.on("click"," tbody td .row-details",function(){var e=$(this).parents("tr")[0],t=$(this).parents("tr").data("selections"),a=$(this).parents("tr").data("pari-type");o.fnIsOpen(e)?($(this).addClass("row-details-close").removeClass("row-details-open"),o.fnClose(e)):($(this).addClass("row-details-open").removeClass("row-details-close"),o.fnOpen(e,fnFormatDetailsForChildsParisEnCours(o,t,a),"details"))}),0==t.count_paris_longterme?e.text(""):e.html(t.count_paris_longterme),$('[data-toggle="tooltip"]').tooltip(),parisEnCoursEnclose(a,"historique")},error:function(e){console.log("le chargement des paris long terme n'a pas fonctionné")}})}function loadParisTermine(){$.ajax({url:"dashboard/ajax/paristermine",data:{page:1},type:"get",success:function(e){function t(e,t){var a='<table class="table table-condensed table-subrow-combine"><thead><tr class="uppercase"><th>date rencontre</th><th>sport</th><th>competition</th><th>rencontre</th><th>pari</th><th>cote</th><th>resultat</th><th>status</th></tr></thead><tbody>';return $.each(t,function(e,t){function r(){switch(t.status){case 0:return"N/A";case 1:return'<span class="bold fontsize15 font-green-sharp">gagné</span>';case 2:return'<span class="bold fontsize15 font-red-haze">perdu</span>';case 3:return'<span class="bold fontsize15 font-green-sharp">1/2 gagné</span>';case 4:return'<span class="bold fontsize15 font-red-haze">1/2 perdu</span>';case 5:return'<span class="bold fontsize15">Remboursé</span>';case 6:return'<span class="bold fontsize15 font-blue">cash out</span>'}}function n(){return""==t.resultat||null==t.resultat?"N/A":t.resultat}function o(){return""==t.score||null==t.score?"":"("+t.score+"LIVE!)"}var s;s=null==t.game_name?"N/A":'<span><img src="img/flags/'+t.equipe1.country.shortname+'.png" class="img-flag"> '+t.equipe1.name+' - </span><span><img src="img/flags/'+t.equipe2.country.shortname+'.png" class="img-flag"> '+t.equipe2.name+"</span>",a+="<tr><td>"+moment.tz(t.date_match,"Europe/Paris").tz(user.timezone).format("DD/MM/YYYY HH:mm")+"</td><td>"+t.sport.name+"</td><td>"+t.competition.name+"</td><td>"+s+"</td><td>"+t.pariAffichage+" ("+t.scope.representation+")"+o()+"</td><td>"+t.cote+"</td><td>"+n()+'</td><td class="uppercase">'+r()+"</td></tr>"}),a+="</tbody></table>";

}$("#tab_15_4").html(e);var a=$("#paristerminetable"),r=document.createElement("th");r.className="table-checkbox";var n=document.createElement("td");n.innerHTML='<span class="row-details row-details-close"></span>',a.find("thead tr").each(function(){this.insertBefore(r,this.childNodes[0])}),a.find("tbody tr").each(function(){this.insertBefore(n.cloneNode(!0),this.childNodes[0])});var o=a.dataTable({language:{processing:"Traitement en cours...",search:"Rechercher&nbsp;:",lengthMenu:"Afficher _MENU_ &eacute;l&eacute;ments",info:"Affichage de l'&eacute;lement _START_ &agrave; _END_ sur _TOTAL_ &eacute;l&eacute;ments",infoEmpty:"Affichage de l'&eacute;lement 0 &agrave; 0 sur 0 &eacute;l&eacute;ments",infoFiltered:"(filtr&eacute; de _MAX_ &eacute;l&eacute;ments au total)",infoPostFix:"",loadingRecords:"Chargement en cours...",zeroRecords:"Aucun &eacute;l&eacute;ment &agrave; afficher",emptyTable:"Aucune donnée disponible dans le tableau",paginate:{first:"Premier",previous:"Pr&eacute;c&eacute;dent",next:"Suivant",last:"Dernier"},aria:{sortAscending:": activer pour trier la colonne par ordre croissant",sortDescending:": activer pour trier la colonne par ordre décroissant"}},lengthMenu:[[5,15,20,100],[5,15,20,100]],pageLength:5,dom:"<'row' <'col-md-6 col-sm-12 margin-bot'B>><'row'<'col-md-6 col-sm-6'l><'col-md-6 col-sm-6'f>r><'table-scrollable't><'row'<'col-md-5 col-sm-6'i><'col-md-7 col-sm-6'p>>",buttons:["excelHtml5","csvHtml5",{extend:"pdfHtml5",orientation:"landscape",download:"open"}]}),s=$("#paristerminetable_wrapper");s.find(".dataTables_length select").select2(),a.on("click"," tbody td .row-details",function(){var e=$(this).parents("tr")[0],a=$(this).parents("tr").data("selections");o.fnIsOpen(e)?($(this).addClass("row-details-close").removeClass("row-details-open"),o.fnClose(e)):($(this).addClass("row-details-open").removeClass("row-details-close"),o.fnOpen(e,t(o,a),"details"))}),parisTermineDelete()},error:function(e){$("#tab_15_4").html("<p>impossible de récuperer les paris terminés</p>")}})}function parisEnCoursEnclose(e,t){var a=e,r=a.find(".boutonvalider");r.on("click",function(e){e.preventDefault();var t=$(this).closest("tr"),a=t.next("tr.details"),r=$(this).data("pari-type"),n=[];"s"==r?n.push(t.find('select[name="status[]"]').val()):(alert(a.html()),n=a.find('select[name="status[]"]').each(function(){n.push($(this).val())})),alert(n),0==a.length&&"c"==r?swal("Erreur","cliquez sur la croix pour dérouler le combiné et selectionner les status."):a.length>0&&"c"==r||("s"==r?$.each(n,function(e,t){}):-1!=n.indexOf(0)&&-1==n.indexOf(2)?"s"==r?swal("Erreur","Vous devez selectionnez un status"):swal("Erreur","Vous êtes obligé de selectionner le status pour chaque selection du combiné sauf si un des paris a le status perdu."):swal("OK","OK"))})}function parisTermineDelete(){var e=$("#paristerminetable");e.find(".bouton-supprimer-historique-pari").click(function(e){e.preventDefault();var t=$(this).data("id"),a=Ladda.create(this);swal({title:"Supprimer le pari",text:"Etes-vous sur?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Oui!",cancelButtonText:"Non, annuler",closeOnConfirm:!0,closeOnCancel:!0},function(e){e&&(a.start(),$.ajax({url:"historique/"+t,type:"delete",success:function(e){0==e.etat?toastr.error(e.msg,"Suppression"):(toastr.success(e.msg,"Suppression"),loadParisTermine(),loadBookmakersOnDashboard(),loadGeneralRecapsOnDashboard())},complete:function(){a.stop()}}))})})}getBookmakersForSelection(),loadParisLongTerme(),loadParisTermine(),loadGeneralRecapsOnDashboard(),loadBookmakersOnDashboard(),gestionTicket(),addManualCouponSelection(),$("#defaultrange").daterangepicker({opens:"left",format:"DD/MM/YYYY",ranges:{"Aujourd'hui":[moment.tz(user.timezone),moment.tz(user.timezone)],Hier:[moment.tz(user.timezone).subtract(1,"days"),moment.tz(user.timezone).subtract(1,"days")],"Cette Semaine":[moment.tz(user.timezone).startOf("isoweek"),moment.tz(user.timezone).endOf("isoweek")],"Semaine Précédente":[moment.tz(user.timezone).subtract(1,"week").startOf("isoweek"),moment.tz(user.timezone).subtract(1,"week").endOf("isoweek")],"Ce Mois":[moment.tz(user.timezone).startOf("month"),moment.tz(user.timezone).endOf("month")],"Mois Précédent":[moment.tz(user.timezone).subtract(1,"month").startOf("month"),moment.tz(user.timezone).subtract(1,"month").endOf("month")]}},function(e,t){$("#defaultrange input").val(e.format("DD/MM/YYYY")+" - "+t.format("DD/MM/YYYY"))}).on("apply.daterangepicker",function(e,t){loadGeneralRecapsOnDashboard()}),$("#WelcomeModal").modal({keyboard:!1,backdrop:"static"});