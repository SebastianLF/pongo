function deleteBookmakerButton(){$(".bookmakerDeleteButton").click(function(r){r.preventDefault();var e=$(this).parents("tr"),o=e.find(".idbookmakertd").text();console.log(o),swal({title:"Supprimer",text:"Etes vous sur ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Oui, supprimer",cancelButtonText:"Non, annuler",closeOnConfirm:!0,closeOnCancel:!0},function(r){r&&$.ajax({url:"bookmaker/"+o,method:"DELETE",data:{id:$("#idbookmakertd").text()},success:function(r){r.success?(toastr.success(r.compte.nom_compte+" à été supprimé avec succès","Compte de bookmaker"),loadBookmakers()):toastr.error("Vous devez d'abord supprimer les paris en cours liés à <strong>"+r.compte.nom_compte+"</strong> !","Compte de bookmaker")},error:function(){console.log("la suppression du compte bookmaker n'a pas fonctionné")}})})})}function editBookmakerButton(){$(".bookmakerEditButton").click(function(){$("#idBookmakerEditInput").val($(this).attr("data-id-bookmaker")),$("#idAccountEditInput").val($(this).attr("data-id")),$("#nameAccountEditInput").val($(this).attr("data-name"))})}function updateBookmaker(){$("#bookmakerform-edit").submit(function(r){r.preventDefault();var e=$(this).find("#idAccountEditInput").val();$.ajax({url:"bookmaker/"+e,method:"PUT",data:$(this).serialize(),dataType:"json",success:function(r){r.success?(loadBookmakers(),toastr.success("Compte mis à jour avec <strong>succes</strong> !","Compte Bookmaker"),$("#bookmakerEditModal").modal("hide")):($("#nameAccountEditContainer").addClass("has-error"),$("#nameAccountEditInput"),toastr.error("<ul><li>"+r.errors.nameAccountEditInput+"</li></ul>","Compte Bookmaker"))},error:function(r){console.log("impossible de mettre à jour le compte bookmaker")}})})}function loadBookmakers(r){r=r||"1",$.ajax({url:"pagination/ajax/bookmakers",data:{page:r},type:"get",success:function(r){$("#bookmakers-pagination").html(r),editBookmakerButton(),deleteBookmakerButton()},error:function(r){console.log("l'affichage des bookmakers n'a pas fonctionné")}})}function gestionTipsters(){function r(){var r=$("#tipsterform-edit");r.submit(function(e){e.preventDefault();var o=$(this).find(p).val(),a=$(this).serialize();$("#tipsterEditModal").on("hide.bs.modal",function(){r.find(n).removeClass("has-error"),r.find(l).removeClass("has-error"),r.find(c).removeClass("has-error"),r.find(s).empty(),r.find(m).empty(),r.find(d).empty(),t.val(""),u.val(""),i.find('option[value="n"]').attr("selected",!0)}),$.ajax({url:"tipster/"+o,method:"PUT",data:a,dataType:"json",success:function(e){e.state?(loadTipsters(),toastr.success("Le tipster à été modifié avec <strong>succès</strong>!","Tipster"),$("#tipsterEditModal").modal("hide")):(e.errors.name_tipster?(r.find(n).addClass("has-error"),r.find(s).html(e.errors.name_tipster)):(r.find(n).removeClass("has-error"),r.find(s).empty()),e.errors.amount_tipster?(r.find(l).addClass("has-error"),r.find(d).html(e.errors.amount_tipster)):(r.find(l).removeClass("has-error"),r.find(d).empty()),e.errors.suivi_tipster?(r.find(c).addClass("has-error"),r.find(m).html(e.errors.suivi_tipster)):(r.find(c).removeClass("has-error"),r.find(m).empty()))}})})}function e(){var r=$("#tipsterform-add");r.submit(function(e){e.preventDefault();{var o=r.find("#name_tipster"),a=r.find("#amount_tipster"),t=r.find("#suivi_tipster");r.find("#nameinputerror"),r.find("#unitnumberinputerror"),r.find("#followtypeselecterror")}$("#tipsterAddModal").on("hide.bs.modal",function(){r.find("#name_container").removeClass("has-error"),r.find("#amount_container").removeClass("has-error"),r.find("#suivi_container").removeClass("has-error"),r.find("#name_error").empty(),r.find("#amount_error").empty(),r.find("#suivi_error").empty(),o.val(""),a.val(""),t.find('option[value="n"]').attr("selected",!0)}),$.ajax({url:"tipster",data:$("#tipsterform-add").serialize(),type:"POST",dataType:"json",success:function(e){0==e.success?(e.errors.name_tipster?(r.find("#name_container").addClass("has-error"),r.find("#name_error").html(e.errors.name_tipster)):(r.find("#name_container").removeClass("has-error"),r.find("#name_error").empty()),e.errors.amount_tipster?(r.find("#amount_container").addClass("has-error"),r.find("#amount_error").html(e.errors.amount_tipster)):(r.find("#amount_container").removeClass("has-error"),r.find("#amount_error").empty()),e.errors.suivi_tipster?(r.find("#suivi_container").addClass("has-error"),r.find("#suivi_error").html(e.errors.suivi_tipster)):(r.find("#suivi_container").removeClass("has-error"),r.find("#suivi_error").empty())):(loadTipsters(),$("#tipsterAddModal").modal("hide"))}})})}function o(){$(".tipsterEditButton").click(function(){var r=$(this).attr("data-suivi");$(p).val($(this).attr("data-id")),$(t).val($(this).attr("data-name")),$(u).val($(this).attr("data-mt")),$(i+' option[value="'+r+'"]').prop("selected",!0)})}function a(){$("#tipsterstable").on("click",".tipsterDeleteButton",function(r){r.preventDefault();var e=$(this).parents("tr"),o=e.find(k).text(),a="tipster/"+o;swal({title:"Supprimer",text:"Etes vous sur ?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Oui, supprimer",cancelButtonText:"Non, annuler",closeOnConfirm:!0,closeOnCancel:!0},function(r){if(r){$.ajax({url:a,method:"DELETE",dataType:"json",success:function(r){1==r.state?(toastr.success("supprimé avec <strong>succès</strong> !","Tipster"),loadTipsters()):2==r.state?swal("Attention!","Vous devez d'abord supprimer les tickets en cours liés à ce tipster.","error"):0==r.state&&swal("Attention!","Ce tipster n'existe pas","error")}})}})})}var t="input[name='name_tipster']",n="#name_container",s="#name_error",i="select[name='suivi_tipster']",c="#suivi_container",m="#suivi_error",u="input[name='amount_tipster']",l="#amount_container",d="#amount_error",p="input[name='id']",k=".idtipstertd";e(),o(),r(),a()}function paginationOnclick(){var r=$("#tipsters-pagination");r.on("click",".pagination a",function(r){r.preventDefault();var e=getPaginationSelectedPage($(this).attr("href"));$.ajax({url:"pagination/ajax/tipsters",data:{page:e},success:function(r){loadTipsters()}})})}function loadTipsters(){$.ajax({url:"pagination/ajax/tipsters",data:{page:"1"},type:"get",success:function(r){$("#tipsters-pagination").html(r),gestionTipsters()}})}function loadTransactions(r){r=r||"1",$.ajax({url:"pagination/ajax/transactions",data:{page:r},type:"get",success:function(r){$("#transactions-pagination").html(r),getBookmakersForSelection("#transactionform-add #booknametransselect","#transactionform-add #accountnametransselect")},error:function(){console.log("le chargement des transactions n'a pas fonctionné")}})}editBookmakerButton(),updateBookmaker(),loadTipsters(),loadBookmakers(),loadTransactions(),$("#addBookmakerButton").click(function(){$("#bookmakerListOnBookmakerContainer").removeClass("has-error"),$("#accountNameBookmakerContainer").removeClass("has-error"),$("#bankrollAmountBookmakerContainer").removeClass("has-error")}),$("#bookmakerform-add").submit(function(r){var e=$(this).serialize();r.preventDefault(),$.ajax({url:"bookmaker",data:e,type:"post",dataType:"json",success:function(r){if(r.success)$("#bookmakerListOnBookmakerContainer").removeClass("has-error"),$("#accountNameBookmakerContainer").removeClass("has-error"),$("#bankrollInvestedBookmakerContainer").removeClass("has-error"),$("#bonusBookmakerContainer").removeClass("has-error"),$("#bankrollAmountBookmakerContainer").removeClass("has-error"),$("#accountnameinput").val(""),$("#bankrollinvestedinput").val(""),$("#bonusinput").val(""),$("#bankrollamountinput").val(""),loadBookmakers(),$("#bookmakerAddModal").modal("hide"),toastr.success("Compte ajouté","Compte Bookmaker");else{var e="<ul>";r.errors.booknameselect?$("#bookmakerListOnBookmakerContainer").addClass("has-error"):$("#bookmakerListOnBookmakerContainer").removeClass("has-error"),r.errors.accountnameinput?$("#accountNameBookmakerContainer").addClass("has-error"):$("#accountNameBookmakerContainer").removeClass("has-error"),r.errors.bankrollamountinput?$("#bankrollAmountBookmakerContainer").addClass("has-error"):$("#bankrollAmountBookmakerContainer").removeClass("has-error"),$.each(r.errors,function(r,o){e+="<li>"+o+"</li>"}),e+="</ul>",toastr.error(e,"Compte bookmaker non ajouté")}},error:function(r){console.log("fail:"+r)}})}),paginationOnclick("pagination/ajax/bookmakers","#bookmakers-pagination"),paginationOnclick(),$(function(){$("#depotAddButton").click(function(){$("#typetransinput").val("depot"),$("#amountTransactionContainer").removeClass("has-error"),$("#booknameTransContainer").removeClass("has-error"),$("#accountnameTransContainer").removeClass("has-error"),$("#describeTransContainer").removeClass("has-error")}),$("#retraitAddButton").click(function(){$("#typetransinput").val("retrait"),$("#amountTransactionContainer").removeClass("has-error"),$("#booknameTransContainer").removeClass("has-error"),$("#accountnameTransContainer").removeClass("has-error"),$("#describeTransContainer").removeClass("has-error")}),$("#bonusAddButton").click(function(){$("#typetransinput").val("bonus"),$("#amountTransactionContainer").removeClass("has-error"),$("#booknameTransContainer").removeClass("has-error"),$("#accountnameTransContainer").removeClass("has-error"),$("#describeTransContainer").removeClass("has-error")});$("#transactionAddModal");$("#transactionform-add").submit(function(r){r.preventDefault(),$.ajax({url:"transaction",type:"post",data:$(this).serialize(),dataType:"json",success:function(r){if(r.success)loadTransactions(),loadBookmakers(),toastr.success("transaction crée avec succès","Transaction");else{var e="<ul>";r.errors.amounttransinput?$("#amountTransactionContainer").addClass("has-error"):$("#amountTransactionContainer").removeClass("has-error"),r.errors.booknametransselect?$("#booknameTransContainer").addClass("has-error"):$("#booknameTransContainer").removeClass("has-error"),r.errors.accountnametransselect?$("#accountnameTransContainer").addClass("has-error"):$("#accountnameTransContainer").removeClass("has-error"),r.errors.describetranstext?$("#describeTransContainer").addClass("has-error"):$("#describeTransContainer").removeClass("has-error"),r.errors.retraitNonDispo,$.each(r.errors,function(r,o){e+="<li>"+o+"</li>"}),e+="</ul>",toastr.error(e,"Transaction non ajouté")}},error:function(){}})})});